<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Stephanie Perniciaro, PhD, MPH">
<meta name="author" content="Shelby Golden, MS">
<meta name="dcterms.date" content="2025-07-01">

<title>Hierarchical Modeling – Public Health Modeling Group</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<link href="../../Images/DSDE-Social-Media-Profile.png" rel="icon" type="image/png">
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-05fe91a66cf75bbbb8c9664867fe5124.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-ec94259342eb9cdba32b75aa83210fd8.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Public Health Modeling Group</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../Pages/Schedule.html"> 
<span class="menu-text">Assignments</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../Pages/Materials/Materials.html"> 
<span class="menu-text">Project Materials</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-weekly-modules" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Weekly Modules</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-weekly-modules">    
        <li>
    <a class="dropdown-item" href="../../Pages/Week2/Time Series Analysis_Hands-On Exercise.html">
 <span class="dropdown-text">Time Series Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Pages/Week3/Hierarchical Modeling.html">
 <span class="dropdown-text">Hierarchical Modeling</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Pages/Week4/Market Basket Analysis.html">
 <span class="dropdown-text">Market Basket Analysis</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://ysph.yale.edu/school-of-public-health/special-programs/big-data-summer-immersion-at-yale/" target="_blank"> 
<span class="menu-text">2025 BDSY</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#distribution-estimation-by-particle-sampling" id="toc-distribution-estimation-by-particle-sampling" class="nav-link" data-scroll-target="#distribution-estimation-by-particle-sampling">Distribution Estimation by Particle Sampling</a>
  <ul class="collapse">
  <li><a href="#recall-markov-chains---a-stochastic-process" id="toc-recall-markov-chains---a-stochastic-process" class="nav-link" data-scroll-target="#recall-markov-chains---a-stochastic-process">Recall Markov Chains - A Stochastic Process</a></li>
  <li><a href="#motivation" id="toc-motivation" class="nav-link" data-scroll-target="#motivation">Motivation</a></li>
  <li><a href="#a-brief-interlude-in-probabilistic-graphical-modeling" id="toc-a-brief-interlude-in-probabilistic-graphical-modeling" class="nav-link" data-scroll-target="#a-brief-interlude-in-probabilistic-graphical-modeling">A Brief Interlude in Probabilistic Graphical Modeling</a></li>
  <li><a href="#gibbs-sampling" id="toc-gibbs-sampling" class="nav-link" data-scroll-target="#gibbs-sampling">Gibbs Sampling</a></li>
  </ul></li>
  <li><a href="#hierarchical-modeling" id="toc-hierarchical-modeling" class="nav-link" data-scroll-target="#hierarchical-modeling">Hierarchical Modeling</a></li>
  <li><a href="#set-up-the-environment" id="toc-set-up-the-environment" class="nav-link" data-scroll-target="#set-up-the-environment">Set Up the Environment</a>
  <ul class="collapse">
  <li><a href="#installing-jags" id="toc-installing-jags" class="nav-link" data-scroll-target="#installing-jags">Installing JAGS</a></li>
  <li><a href="#data-dictionary" id="toc-data-dictionary" class="nav-link" data-scroll-target="#data-dictionary">Data Dictionary</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/ysph-dsde/bdsy-phm/blob/main/Pages/Week3/Hierarchical Modeling.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/ysph-dsde/bdsy-phm/issues" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Hierarchical Modeling</h1>
<p class="subtitle lead"></p><div class="line-block">In Class Hands-On Exercise<br>
BDSY 2025 - Public Health Modeling Project</div><p></p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Stephanie Perniciaro, PhD, MPH </p>
             <p>Shelby Golden, MS </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 1, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Page still in progress!!
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Real-world analytical problems are often complex, making it difficult to define or derive deterministic solutions. Two common approaches to support complex analytical projects are:</p>
<ol type="1">
<li>Approximating with a known solvable function.</li>
<li>Using stochastic search and optimization, such as Monte Carlo methods.</li>
</ol>
<p>While the first approach has many advantages, there are circumstances where approximating a problem with a known distribution is computationally prohibitive, overly reductive, or infeasible. In such cases, we leverage abstract probabilistic and statistical concepts to transform randomness into inferential statistics. When applied correctly, these concepts can surprisingly guarantee robust solutions to otherwise unsolvable problems.</p>
<p>One of these powerful techniques is Markov chain Monte Carlo (MCMC). Random samples generated with MCMC can be used for various purposes, including computing statistical estimates, numerical integrals, and estimating the marginal or joint probabilities of multivariate distributions and densities&nbsp;<span class="citation" data-cites="Spall2005"><sup><a href="#ref-Spall2005" role="doc-biblioref">1</a></sup></span>. Notably, MCMC provides a means to generate samples from joint distributions by utilizing conditional, factorized distributions&nbsp;<span class="citation" data-cites="Spall2005 Koller2009"><sup><a href="#ref-Spall2005" role="doc-biblioref">1</a>,<a href="#ref-Koller2009" role="doc-biblioref">2</a></sup></span>.</p>
<p>Two common MCMC implementations are Metropolis-Hastings (M-H) and Gibbs sampling, with the latter being more accurately considered a special case of the former. Students are encouraged to explore M-H further on their own by reading the relevant sections of the supporting textbooks listed below. Today, we will focus on Gibbs sampling and only discuss M-H where it supports this learning, as Gibbs sampling is particularly well-suited for reducing high-dimensional problems into several one-dimensional ones&nbsp;<span class="citation" data-cites="Spall2005 Wasserman2004"><sup><a href="#ref-Spall2005" role="doc-biblioref">1</a>,<a href="#ref-Wasserman2004" role="doc-biblioref">3</a></sup></span>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solid theory supports effective and accurate application!
</div>
</div>
<div class="callout-body-container callout-body">
<p>The concepts discussed here have been compiled and summarized from various resources listed in the bibliography at the end of this page. We would like to specifically highlight the following textbooks, with suggested readings, to help students deepen their theoretical understanding of this week’s material. This foundation will aid in generating better analysis in practice.</p>
<ul>
<li><a href="https://link.springer.com/book/10.1007/978-0-387-21736-9"><em>All of Statistics: A Concise Course in Statistical Inference</em></a> by Larry Wasserman&nbsp;<span class="citation" data-cites="Wasserman2004"><sup><a href="#ref-Wasserman2004" role="doc-biblioref">3</a></sup></span>
<ul>
<li>Chapter 23 <em>Probability Redux: Stochastic Processes</em> Section 23.2 <em>Markov chains</em>.</li>
<li>Chapter 24 <em>Simulation Methods</em>. Section 24.4 <em>MCMC Part I: The Metropolis-Hastings Algorithm</em> and Section 24.5 <em>MCMC Part II: Different Flavors</em>.</li>
</ul></li>
<li><a href="https://www.jhuapl.edu/isso/"><em>Introduction to Stochastic Search and Optimization: Estimation, Simulation, and Control</em></a> by James C. Spall&nbsp;<span class="citation" data-cites="Spall2005"><sup><a href="#ref-Spall2005" role="doc-biblioref">1</a></sup></span>
<ul>
<li>Chapter 16 <em>Markov chain Monte Carlo</em> Section 16.1 <em>Background</em>, Section 16.2 <em>Metropolis-Hastings Algorithm</em>, and Section 16.3 <em>Gibbs Sampling</em>.</li>
</ul></li>
<li><a href="https://mitpress.mit.edu/9780262013192/probabilistic-graphical-models/"><em>Probabilistic Graphical Models - Principles and Techniques</em></a> by Koller and Friedman&nbsp;<span class="citation" data-cites="Koller2009"><sup><a href="#ref-Koller2009" role="doc-biblioref">2</a></sup></span>
<ul>
<li>Chapter 3 <em>The Bayesian Network Representation</em> Section 3.1 <em>Exploiting Independence Properties</em>, Section 3.2 <em>Bayesian Networks</em>, and Section 3.3 <em>Independencies in Graphs</em>.</li>
<li>Chapter 4 Unirected <em>Graphical Models</em>.</li>
<li>Chapter 12 <em>Particle-Based Approximate Inference</em> Section 12.3 <em>Markov Chain Monte Carlo Methods</em>.</li>
<li>Chapter 17 <em>Parameter Estimation</em> Section 17.5 <em>Learning Models with Shared Parameters</em>.</li>
</ul></li>
</ul>
</div>
</div>
</section>
<section id="distribution-estimation-by-particle-sampling" class="level2">
<h2 class="anchored" data-anchor-id="distribution-estimation-by-particle-sampling">Distribution Estimation by Particle Sampling</h2>
<div class="img-float">
<div class="quarto-figure quarto-figure-center" style="float: right; position: relative; top: 0px; padding-left: 20px; margin: auto auto auto auto; text-align: right;">
<figure class="figure">
<p><img src="Images/Probabilistic Graphical Models by Koller and Friedman_Abstraction of Intro to Chapter 12.png" class="img-fluid figure-img" width="350"></p>
<figcaption>Abstraction of the introduction to Chapter 12 <em>Particle-Based</em><br><em>Approximate Inference</em> found in <em>Probabilistic Graphical Models</em> by<br>Koller and Friedman. Points on the graph are only illustrative<br>of the variation in techniques&nbsp;<span class="citation" data-cites="Koller2009"><sup><a href="#ref-Koller2009" role="doc-biblioref">2</a></sup></span>.</figcaption>
</figure>
</div>
</div>
<p><strong>Particle-based methods</strong> approximate a multivariate distribution or network with a set of instantiations, referred to as <strong>particles</strong>, of some or all of the random variables in that distribution<span class="citation" data-cites="Koller2009"><sup><a href="#ref-Koller2009" role="doc-biblioref">2</a></sup></span>. There are different flavors of this type of method illustrated on the right. Some particles are generated directly from an equation, while others are sampled from a distribution. Some particles represent all the variables in a distribution or network individually, while others assign a proxy variable that groups them&nbsp;<span class="citation" data-cites="Koller2009"><sup><a href="#ref-Koller2009" role="doc-biblioref">2</a></sup></span>.</p>
<p>Today we are discussing one type of particle estimation: Gibbs sampling. In most cases, random variables are represented individually. However, readers should be aware that there are variations of Gibbs sampling that facilitate grouping the full set of random variables into “blocks”.</p>
<section id="recall-markov-chains---a-stochastic-process" class="level3">
<h3 class="anchored" data-anchor-id="recall-markov-chains---a-stochastic-process">Recall Markov Chains - A Stochastic Process</h3>
<p>This section summarizes relevant concepts presented in Wasserman’s <em>All of Statistics</em>, specifically Chapter 23&nbsp;<span class="citation" data-cites="Wasserman2004"><sup><a href="#ref-Wasserman2004" role="doc-biblioref">3</a></sup></span>. Unless otherwise noted, the content comes from Wasserman’s <em>All of Statistics</em>.</p>
<p>A <strong>stochastic process</strong> <span class="math inline">\{X_t : t \in T\}</span> is a collection of random variables taken from a <strong>state space</strong>, <span class="math inline">\mathcal{X}</span>, and indexed by an ordered set <span class="math inline">T</span>, which can be interpreted as time. The index set <span class="math inline">T</span> can be discrete, such as <span class="math inline">T = \{0, 1, 2, \dots\}</span>, or continuous, such as <span class="math inline">T = [0, \infty)</span>. To denote the stochastic nature of <span class="math inline">X</span>, it can be written as <span class="math inline">X_t</span> or <span class="math inline">X(t)</span>.</p>
<div class="img-float">
<div class="quarto-figure quarto-figure-center" style="float: left; position: relative; top: 0px; padding-right: 10px; margin: auto auto auto auto;">
<figure class="figure">
<p><img src="Images/Lee and Ni 2012_Figure 1.jpg" class="img-fluid figure-img" width="450"></p>
<figcaption>Illustration of state transition diagram for the Markov chain&nbsp;<span class="citation" data-cites="Lee2012"><sup><a href="#ref-Lee2012" role="doc-biblioref">4</a></sup></span>.</figcaption>
</figure>
</div>
</div>
<p>A <strong>Markov chain</strong> is a type of stochastic process where the distribution of future states depends only on the current state and not on the sequence of events that preceded it. For example, the outcome for <span class="math inline">X_t</span> depends only on what the outcome was for <span class="math inline">X_{t-1}</span>. Notice that sometimes, authors with specify that <span class="math inline">X</span> is a Markov chain stochastic process by writing <span class="math inline">X_n</span> instead of <span class="math inline">X_t</span>.</p>
<p>The figure on the left shows a state transition diagram for a discrete-time Markov chain with <strong>transition probabilities</strong> <span class="math inline">p_{ij} = \mathbb{P}(X_{n+1}= j\ \lvert\ X_n = i)</span>. Below the diagram is the matrix representation of these interactions, known as the <strong>transition matrix</strong>, <span class="math inline">\mathbf{P}</span>, where each row is a probability mass function. A generalized definition for a Markov chain is given by</p>
<p><span class="math display">
\mathbb{P}(X_n = x\ \lvert\ X_0, \dots, X_{n-1}) = \mathbb{P}(X_n = x\ \lvert\ X_{n-1})
</span></p>
<p>for all <span class="math inline">n</span> and for all <span class="math inline">x \in \mathcal{X}</span>. Markov chains have many aspects, but for this application, it is essential to consider the properties of a specific transitional stage denoted by, <span class="math inline">\pi = (\pi_i : i \in \mathcal{X})</span>. The vector <span class="math inline">\pi</span> consists of non-negative numbers that sum to one and is a stationary (or invariant) distribution if <span class="math inline">\pi = \pi\mathbf{P}</span>.</p>
<p>By applying the Chapman-Kolmogorov equations for n-step probabilities, where it is shown that <span class="math inline">p_{ij}(m+n) = \sum_k p_{ik}(m) p_{kj}(n)</span>, we derive that a key characteristic of a stationary distribution <span class="math inline">\pi</span> for a Markov chain is that it is limiting. This means that, after any number of steps <span class="math inline">n</span>, a distribution that reaches <span class="math inline">\pi</span> remains as <span class="math inline">\pi</span>:</p>
<ol type="1">
<li><p>Draw <span class="math inline">X_0</span> from the distribution <span class="math inline">\pi</span> gives <span class="math inline">\mu_0 = \pi</span>.</p></li>
<li><p>Draw <span class="math inline">X_1</span> from the distribution <span class="math inline">\pi</span> gives <span class="math inline">\mu_1 = \mu_0\mathbf{P} = \pi\mathbf{P} = \pi</span>.</p></li>
<li><p>Draw <span class="math inline">X_2</span> from the distribution <span class="math inline">\pi</span> gives <span class="math inline">\pi\mathbf{P}^2 = (\pi\mathbf{P})\mathbf{P} = \pi\mathbf{P} = \pi</span>.</p>
<p><span class="math inline">\dots</span> etc.</p></li>
</ol>
<p>Here, <span class="math inline">\mu_n(i) = \mathbb{P}(X_n = i)</span> denotes the marginal probability that the chain is in state <span class="math inline">i</span> at time <span class="math inline">n</span>, while <span class="math inline">\mu_0</span> represents the <strong>initial distribution</strong>. Once the chain limits to the distribution <span class="math inline">\pi</span>, it will remain in this distribution indefinitely. However, ensuring the process is stationary is not sufficient; it is also important to guarantee that <span class="math inline">\pi</span> is unique. This uniqueness is guaranteed if the Markov chain is <strong>ergodic</strong>, which must satisfy the following two characteristics&nbsp;<span class="citation" data-cites="Bishop2006 Wasserman2004"><sup><a href="#ref-Wasserman2004" role="doc-biblioref">3</a>,<a href="#ref-Bishop2006" role="doc-biblioref">5</a></sup></span>:</p>
<ol type="1">
<li><strong>Aperiodicity:</strong> The states do not get trapped in cycles of fixed length. This means revisiting any state does not happen at regular intervals, ensuring more general behavior. For <span class="math inline">d = \text{gcd}\{n\ :\ p_{ii}(n) &gt; 0\}</span> then <span class="math inline">d(i) = 1</span>, where gcd means “greatest common divisor”.</li>
<li><strong>Positive Recurrence:</strong> The expected number of steps to return to that state is finite. A Markov chain is positive recurrent if every state is positive recurrent.</li>
</ol>
<p>If the Markov chain is also <strong>irreducible</strong>, then all states communicate, meaning it is possible to get from any state to any other state, denoted by <span class="math inline">i \leftrightarrow j</span>. Having an irreducible, ergodic Markov chain guarantees that it has a unique stationary distribution, <span class="math inline">\pi</span>.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>A Markov chain with a stationary distribution does not mean that it converges.</p>
</div>
</div>
<p>There is much more to learn about Markov chains beyond what was discussed here, but these fundamental concepts provide a foundation for understanding their use in Monte Carlo methods.</p>
</section>
<section id="motivation" class="level3">
<h3 class="anchored" data-anchor-id="motivation">Motivation</h3>
<p>Traditionally, Monte Carlo methods rely on independent sampling. However, MCMC methods rely on a dependent Markov sequence with a limiting distribution that corresponds to the distribution we aim to model&nbsp;<span class="citation" data-cites="Spall2005"><sup><a href="#ref-Spall2005" role="doc-biblioref">1</a></sup></span>. MCMC has wide-ranging applications and is frequently used in Bayesian inference. However, it is also generalizable to other problems that are not Bayesian in nature&nbsp;<span class="citation" data-cites="Spall2005"><sup><a href="#ref-Spall2005" role="doc-biblioref">1</a></sup></span>.</p>
<p>To help you understand the connection between Monte Carlo sampling methods and estimating complex analytical solutions using Markov chains, let’s first explore the motivation: initially within the commonly exemplified Bayesian framework, and then in a general sense. Consider the following scenario provided by Wasserman in the context of Bayesian inference where we have a process that generates the random vector <span class="math inline">X</span>&nbsp;<span class="citation" data-cites="Wasserman2004"><sup><a href="#ref-Wasserman2004" role="doc-biblioref">3</a></sup></span>. We have the prior distribution <span class="math inline">f(\theta)</span> with respect to parameter <span class="math inline">\theta</span> and data <span class="math inline">\mathbf{X} = (X_1, \dots, X_n)</span> with a posterior density</p>
<p><span class="math display">
f(\theta\ \lvert\ \mathbf{X}) = \frac{\mathcal{L}(\theta)\ f(\theta)}{\int \mathcal{L}(\theta)\ f(\theta)\ d\theta}
</span></p>
<p>where the denominator is the normalizing constant, here denoted by <span class="math inline">c</span>. The mean of the posterior is <span class="math display">\begin{align*}
\bar{\theta} &amp;= \int \theta\ f(\theta\ \lvert\ \mathbf{X})\ d\theta \\
&amp;= \frac{1}{c} \int \theta\ \mathcal{L}(\theta)\ f(\theta)\ d\theta
\end{align*}</span></p>
<p>If the parameter space is multidimensional, i.e., <span class="math inline">\boldsymbol{\theta} = (\theta_1, \dots, \theta_k)</span>, but we are only interested in one component, say <span class="math inline">\theta_1</span>, then the marginal posterior density of <span class="math inline">\theta_1</span> is defined as <span class="math display">
f(\theta_1\ \lvert\ \mathbf{X}) = \int\int\cdots\int f(\theta_1, \dots, \theta_k\ \lvert\ \mathbf{X})\ d\theta_2 \cdots\ d\theta_k
</span></p>
<p>As can easily be seen, it might not always be feasible to calculate this outcome directly. Generally speaking, we have a random vector <span class="math inline">\mathbf{X}</span> and we wish to compute <span class="math inline">E[f(\mathbf{X})]</span>&nbsp;<span class="citation" data-cites="Spall2005"><sup><a href="#ref-Spall2005" role="doc-biblioref">1</a></sup></span>. If the random vector is continuous and associated with the probability density <span class="math inline">p(\boldsymbol{x})</span>, then we want to calculate <span class="math display">
E[f(\mathbf{X})] = \int f(\boldsymbol{x})\ p(\boldsymbol{x})\ d\boldsymbol{x}
</span></p>
<p>The density <span class="math inline">p(\boldsymbol{x})</span> is often referred to as the <strong>target density</strong>, representing the distribution of the random variables that are of interest in our study&nbsp;<span class="citation" data-cites="Spall2005"><sup><a href="#ref-Spall2005" role="doc-biblioref">1</a></sup></span>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Markov chains are typically reserved for discrete outcomes. However, general applications of MCMC can be used for discrete, continuous, or hybrid outcomes. In this context, Markov chains can be applied to any type of distribution&nbsp;<span class="citation" data-cites="Spall2005"><sup><a href="#ref-Spall2005" role="doc-biblioref">1</a></sup></span>.</p>
</div>
</div>
<p>Standard Monte Carlo methods aim to draw <span class="math inline">n</span> independent, identically distributed (i.i.d.) samples of <span class="math inline">\mathbf{X}</span> directly from <span class="math inline">p(\boldsymbol{x})</span>, but this is also not always feasible&nbsp;<span class="citation" data-cites="Spall2005"><sup><a href="#ref-Spall2005" role="doc-biblioref">1</a></sup></span>. Simple random generation methods require specific restrictions to ensure a solution or might be computationally inefficient in high-dimensional problems. For example, the adaptation of the accept-reject method from <em>Monte Carlo Statistical Methods</em> by Robert and Casella, called adaptive rejection sampling, is restricted to densities that are log-concave and has computational power requirements that are proportional to the fifth power of <span class="math inline">\text{dim}(\mathbf{X})</span>&nbsp;<span class="citation" data-cites="Spall2005 Robert2004"><sup><a href="#ref-Spall2005" role="doc-biblioref">1</a>,<a href="#ref-Robert2004" role="doc-biblioref">6</a></sup></span>.</p>
<p>Canonical Monte Carlo approaches are more restrictive than is necessary to estimate <span class="math inline">E[f(\mathbf{X})]</span>. Leveraging Markov chain-based schemes avoids the necessity of sampling directly from <span class="math inline">p(\boldsymbol{x})</span>; instead, dependent sequences with a limiting distribution of <span class="math inline">p(\boldsymbol{x})</span> are used&nbsp;<span class="citation" data-cites="Spall2005"><sup><a href="#ref-Spall2005" role="doc-biblioref">1</a></sup></span>.</p>
<p>Recall that in the previous section, we showed that a Markov chain that is irreducible and ergodic is guaranteed to have a unique stationary distribution, <span class="math inline">\pi</span>&nbsp;<span class="citation" data-cites="Wasserman2004"><sup><a href="#ref-Wasserman2004" role="doc-biblioref">3</a></sup></span>. This is a consequence of the ergodic theorem, which guarantees that the normalized sum below will approach the mean of <span class="math inline">f(\mathbf{X})</span>, with convergence in mean square (m.s.) or almost surely (a.s.) as <span class="math inline">n \rightarrow \infty</span> for any fixed <span class="math inline">M</span>&nbsp;<span class="citation" data-cites="Spall2005"><sup><a href="#ref-Spall2005" role="doc-biblioref">1</a></sup></span>.</p>
<p><span class="math display">
\frac{1}{n-M} \sum_{k = M+1}^n\ f(\mathbf{X}_k)
</span></p>
<p>Here, <span class="math inline">M</span> is referred to as the “burn-in” period. We know that the dependence of <span class="math inline">\mathbf{X}_k</span> on early states, say <span class="math inline">\mathbf{X}_0, \mathbf{X}_1, \dots, \mathbf{X}_M</span>, for bounded <span class="math inline">M &lt; \infty</span>, disappears as <span class="math inline">k \rightarrow \infty</span>&nbsp;<span class="citation" data-cites="Spall2005"><sup><a href="#ref-Spall2005" role="doc-biblioref">1</a></sup></span>. With sufficient burn-in, we achieve the ergodic average that stabilizes at <span class="math inline">\pi</span>, and when executed correctly, <span class="math inline">\pi</span> equals the target density to within a scalar value&nbsp;<span class="citation" data-cites="Wasserman2004 Spall2005"><sup><a href="#ref-Spall2005" role="doc-biblioref">1</a>,<a href="#ref-Wasserman2004" role="doc-biblioref">3</a></sup></span>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Types of Convergence
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>This excerpt summarizes Spall’s <em>Introduction to Stochastic Search and Optimization: Estimation, Simulation, and Control</em> Appendix C.2 Convergence Theory&nbsp;<span class="citation" data-cites="Spall2005"><sup><a href="#ref-Spall2005" role="doc-biblioref">1</a></sup></span>.</p>
<p>Finite-sampled stochastic algorithms are often intractable, justifying the focus on the behavior of stochastic processes in their limit. The type of convergence properties a process has informs us about the scenarios where it is appropriate to apply the theory in practice and provides insight into non-limiting behaviors. Convergence for stochastic algorithms is probabilistic and characterized by measure-theoretic concepts, often classified into the following four types:</p>
<p><span class="math display">
\gdef\norm#1{\left\lVert#1\right\rVert}
</span></p>
<p><strong>Convergence almost surely:</strong> The sequence of random vectors <span class="math inline">\mathbf{X}_k \rightarrow \mathbf{X}</span> a.s. (or with probability 1)</p>
<p><span class="math display">
P\left(\omega \in \Omega \ : \ \lim_{k \rightarrow \infty}\ \norm{\mathbf{X}_k(\omega) - \mathbf{X}(\omega)} = 0\right) = 1
</span></p>
<p><strong>Convergence in probability:</strong> The sequence of random vectors <span class="math inline">\mathbf{X}_k \rightarrow \mathbf{X}</span> in pr.</p>
<p><span class="math display">
\lim_{k \rightarrow \infty} P\left(\omega \in \Omega \ : \ \norm{\mathbf{X}_k(\omega) - \mathbf{X}(\omega)} \geq c\right) = 0\ \ \ \text{ for any } c &gt; 0
</span></p>
<p><strong>Convergence in mean square:</strong> The sequence of random vectors <span class="math inline">\mathbf{X}_k \rightarrow \mathbf{X}</span> in m.s.</p>
<p><span class="math display">
\lim_{k \rightarrow \infty} E\left(\norm{\mathbf{X}_k(\omega) - \mathbf{X}(\omega)}^2\right) = 0
</span></p>
<p><strong>Convergence in distribution:</strong> The sequence of random vectors <span class="math inline">\mathbf{X}_k \rightarrow \mathbf{X}</span> in m.s.</p>
<p><span class="math display">
\lim_{k \rightarrow \infty} F_{\mathbf{X}_k}(\boldsymbol{x}) = F_{\mathbf{X}}(\boldsymbol{x})\ \ \ \text{ at every point } \boldsymbol{x} \text{ where } F_{\mathbf{X}}(\boldsymbol{x}) \text{ is continuous.}
</span></p>
<p>where <span class="math inline">\norm{\cdot}</span> denotes any valid norm, i.e., the Euclidean norm <span class="math inline">\norm{\boldsymbol{x}} = \sqrt{\sum_i x_i^2}</span>, and <span class="math inline">x_i</span> is the <span class="math inline">i^{th}</span> component of the vector <span class="math inline">\boldsymbol{x}</span>.</p>
</div>
</div>
</div>
<p>In the next section, we will show how Gibbs sampling produces the correct mean, computed with respect to our target density <span class="math inline">p(\boldsymbol{x})</span>. In summary, we have thus far introduced the basic concepts around Markov chains that simplify random sampling from conditional distributions, which are guaranteed to converge if irreducible and ergodic. With the appropriate burn-in, <span class="math inline">M</span>, we can ensure the ergodic average stabilizes at <span class="math inline">\pi</span>. We now want to show that Gibbs sampling is capable of producing a stabilized limiting distribution, <span class="math inline">\pi</span>, that is proportional to our target density <span class="math inline">p(\boldsymbol{x})</span>.</p>
</section>
<section id="a-brief-interlude-in-probabilistic-graphical-modeling" class="level3">
<h3 class="anchored" data-anchor-id="a-brief-interlude-in-probabilistic-graphical-modeling">A Brief Interlude in Probabilistic Graphical Modeling</h3>
<p>The concept of Gibbs sampling was introduced by Geman and Geman in their paper <em>Stochastic Relaxation, Gibbs Distributions, and the Bayesian Restoration of Images</em>&nbsp;<span class="citation" data-cites="Geman1984 Bishop2006 Spall2005"><sup><a href="#ref-Spall2005" role="doc-biblioref">1</a>,<a href="#ref-Bishop2006" role="doc-biblioref">5</a>,<a href="#ref-Geman1984" role="doc-biblioref">7</a></sup></span>. In their work, they identified the equivalence between Markov random fields and the Gibbs distribution, also known as the Boltzmann distribution, which had been previously used in physical chemistry to relate the probability of a system’s state to its energy and temperature&nbsp;<span class="citation" data-cites="Geman1984 gibbs_dist"><sup><a href="#ref-Geman1984" role="doc-biblioref">7</a>,<a href="#ref-gibbs_dist" role="doc-biblioref">8</a></sup></span>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Josiah Gibbs: Yale’s First Engineering Ph.D.&nbsp;and Chair of Mathematical Physics
</div>
</div>
<div class="callout-body-container callout-body">
<p>Gibbs sampling is named after the American mechanical engineer and scientist, Josiah Willard Gibbs, who received the first Ph.D.&nbsp;in engineering in the United States in 1863 from Yale University. He was also appointed the first chair of mathematical physics in the United States at Yale, and contributed to many areas in physics, chemistry, and mathematics. Gibbs is credited with laying the foundation for the field of physical chemistry&nbsp;<span class="citation" data-cites="josiah_gibbs Bishop2006"><sup><a href="#ref-Bishop2006" role="doc-biblioref">5</a>,<a href="#ref-josiah_gibbs" role="doc-biblioref">9</a></sup></span>.</p>
</div>
</div>
<p>Fundamentally, this is why Gibbs sampling has a natural intuition tied to graphical modeling, a broader subject that we will only lightly touch upon in this week’s concept. Some sources attempt to explain Gibbs sampling outside of the graphical model framework, but the more comprehensive ones will acknowledge this connection. It is beyond our scope to bring students entirely up to speed with graphical theory, so additional reading has been provided earlier to help bridge this gap if readers find any of the content too advanced.</p>
<p>In practice, especially in medical diagnosis problems, there may be hundreds of attributes that contribute to the joint probability distribution for a given disease&nbsp;<span class="citation" data-cites="Koller2009"><sup><a href="#ref-Koller2009" role="doc-biblioref">2</a></sup></span>. Furthermore, some of these distributions may overlap or have similarities with those of other diseases, making them challenging to separate using standard probabilistic approaches. Probabilistic graphical models are graph-based representations of variable interactions, which can help to succinctly represent these interactions in digestible pieces despite their high dimensionality&nbsp;<span class="citation" data-cites="Koller2009"><sup><a href="#ref-Koller2009" role="doc-biblioref">2</a></sup></span>.</p>
<p>More impressively, graphical modeling encodes interaction attributes such as independencies, factorization, pathways, and message propagation. This not only provides an intuitive understanding of complex interactions but also allows for the exploitation of these features for inference and efficient computation&nbsp;<span class="citation" data-cites="Koller2009 Bishop2006"><sup><a href="#ref-Koller2009" role="doc-biblioref">2</a>,<a href="#ref-Bishop2006" role="doc-biblioref">5</a></sup></span>. Shown below are two fundamental ways in which variables and their relationships with one another can be represented: a Bayesian network, also referred to as a Directed Graph, and a Markov network, also known as an Undirected Graph.</p>
<div class="quarto-figure quarto-figure-center" style="float: none; display: block; margin-left: auto; margin-right: auto; width: 90%;">
<figure class="figure">
<p><img src="Images/Probabilistic Graphical Models by Koller and Friedman_Modified Figure 1.1.png" class="img-fluid figure-img"></p>
<figcaption>Modified version of Figure 1.1 from <em>Probabilistic Graphical Models</em> by Koller and Friedman&nbsp;<span class="citation" data-cites="Koller2009"><sup><a href="#ref-Koller2009" role="doc-biblioref">2</a></sup></span>.</figcaption>
</figure>
</div>
<p>The key concept exemplified by the figure above is independence properties. These can differ for the same graph depending on whether the relationships between variables are defined as directed or undirected, but ultimately allow for factorization representing these independence assertions. The notation differences for factorized joint distributions, shown at the bottom of the figure, are used to differentiate the types of dependency structures implied by the graph itself.</p>
<p>By definition, the Markov network factorization is a Gibbs distribution parameterized by the set of factors <span class="math inline">\Phi = {\phi(A, B), \phi(B, C), \phi(C, D), \phi(A, D)}</span> with the normalizing constant called the partition function</p>
<p><span class="math display">
Z = \sum_{X_1, \dots, X_n}\ \tilde{P}_{\Phi}(X_1, \dots, X_n)
</span> where <span class="math inline">\tilde{P}_{\Phi}</span> represents the joint distribution factorized into conditional probabilities based on its independencies&nbsp;<span class="citation" data-cites="Koller2009"><sup><a href="#ref-Koller2009" role="doc-biblioref">2</a></sup></span>.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Factor <span class="math inline">\neq</span> Marginal
</div>
</div>
<div class="callout-body-container callout-body">
<p>A factor is one contribution to the overall joint distribution, while a marginal represents a distribution where at least one variable from the joint has been summed or integrated out&nbsp;<span class="citation" data-cites="Koller2009"><sup><a href="#ref-Koller2009" role="doc-biblioref">2</a></sup></span>.</p>
</div>
</div>
<p>Although we have discussed Markov chains earlier and provided the explicit definition of a Gibbs distribution in the context of probabilistic graphical modeling, this does not imply that Gibbs sampling is exclusively applicable to undirected graphs&nbsp;<span class="citation" data-cites="Bishop2006"><sup><a href="#ref-Bishop2006" role="doc-biblioref">5</a></sup></span>. How the differences affect Gibbs sampling is discussed in the next section.</p>
</section>
<section id="gibbs-sampling" class="level3">
<h3 class="anchored" data-anchor-id="gibbs-sampling">Gibbs Sampling</h3>
<p>In the M-H algorithm, we start with a <strong>proposed distribution</strong>, <span class="math inline">q(\cdot\ \lvert x)</span>, from which we can sample, but which is not directly the target distribution, <span class="math inline">p(\boldsymbol{x})</span>. In many cases, it may be chosen arbitrarily, as long as its limiting behaviors converge to the target distribution&nbsp;<span class="citation" data-cites="Spall2005"><sup><a href="#ref-Spall2005" role="doc-biblioref">1</a></sup></span>. For MCMC conducted using the M-H algorithm to work, we need to ensure <span class="math inline">\pi</span> satisfies detailed balance, where the probability of transitioning from state <span class="math inline">i</span> to <span class="math inline">j</span> must be equal to the probability of the reverse transition when multiplied by their respective stationary distribution probabilities&nbsp;<span class="citation" data-cites="Wasserman2004"><sup><a href="#ref-Wasserman2004" role="doc-biblioref">3</a></sup></span>.</p>
<p><span class="math display">
\pi_i p_{ij} = \pi_j p_{ji}
</span></p>
<p>At each step in the algorithm, a candidate point is drawn from the proposal distribution, denoted using the random variable <span class="math inline">\mathbf{W}</span>. Assuming that this proposal distribution satisfies detailed balance and is a superset of the points for the target distribution (ensuring they are fully supported), then candidate draws are kept or discarded with probability <span class="math inline">\rho(\mathbf{X}_k, \mathbf{W})</span>&nbsp;<span class="citation" data-cites="Spall2005"><sup><a href="#ref-Spall2005" role="doc-biblioref">1</a></sup></span></p>
<p><span class="math display">
\rho(\boldsymbol{x}, \boldsymbol{w}) = \min\left\{\frac{p(\boldsymbol{w})}{p(\boldsymbol{x})} \frac{q(\boldsymbol{x}\ \lvert\ \boldsymbol{w})}{q(\boldsymbol{w}\ \lvert\ \boldsymbol{x})},\ 1\right\}
</span></p>
<p>If a candidate point is accepted, then <span class="math inline">\mathbf{X}_{k+1} = \mathbf{W}</span>; otherwise, <span class="math inline">\mathbf{X}_{k+1} = \mathbf{X}_k</span>&nbsp;<span class="citation" data-cites="Spall2005"><sup><a href="#ref-Spall2005" role="doc-biblioref">1</a></sup></span>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>When samples from the Markov chain start to resemble the target distribution, it is said to be “mixing well”&nbsp;<span class="citation" data-cites="Wasserman2004"><sup><a href="#ref-Wasserman2004" role="doc-biblioref">3</a></sup></span>. Tweaking the parameters used in the proposed distribution to support good mixing is not always straightforward and may require some trial-and-error troubleshooting; refer to example 24.10 from Wasserman’s <em>All of Statistics</em> for an illustration of this.</p>
</div>
</div>
<p>Gibbs sampling is much like M-H, but it is a special case where the proposal distribution comes directly from the conditional factorizations of <span class="math inline">p(\boldsymbol{x})</span> itself. In a sense, it can be thought of as <span class="math inline">m</span> M-H algorithms working together, where each proposed distribution is one conditional factorization of <span class="math inline">p(\boldsymbol{x})</span>&nbsp;<span class="citation" data-cites="Spall2005"><sup><a href="#ref-Spall2005" role="doc-biblioref">1</a></sup></span>. In this context, <span class="math inline">m</span> represents the number of random variables, each having its own conditional distribution for sampling. Consider the following scenario from Spall where we have a distribution <span class="math inline">p_{X,Y,Z}(\cdot)</span> that we wish to sample from:</p>
<ol type="1">
<li>Start with an initial guess for <span class="math inline">Y</span> and <span class="math inline">Z</span> and sample from <span class="math inline">p_{X \mid Y_0, Z_0}(x \mid Y_0, Z_0)</span> to generate <span class="math inline">X_1</span>.</li>
<li>Accept the outcome from the previous step and sample from <span class="math inline">p_{Y \mid X_1, Z_0}(y \mid X_1, Z_0)</span> to generate <span class="math inline">Y_1</span>.</li>
<li>Accept the outcome from the previous step and sample from <span class="math inline">p_{Z \mid X_1, Y_1}(z \mid X_1, Y_1)</span> to generate <span class="math inline">Z_1</span>.</li>
<li>Repeat the process until you have <span class="math inline">n-1</span> values for <span class="math inline">X</span> and <span class="math inline">n</span> values for <span class="math inline">Y</span> and <span class="math inline">Z</span>.</li>
</ol>
<p>At the end of this process, you will have produced the <strong>Gibbs sequence</strong>. For the example above, we produce:</p>
<p><span class="math display">
Y_0, Z_0;\ X_1, Y_1, Z_1;\ X_2, Y_2, Z_2;\ \dots; X_n, Y_n, Z_n
</span></p>
<p>The process described above is iterated over all variables and conditional statements until it is possible to compute the ergodic average. According to the ergodic theorem, this occurs when a sufficient burn-in period has been allowed to run. Using the example above, if we set our burn-in period to <span class="math inline">M &lt; n</span>, then the appended <strong>Gibbs sequence</strong> <span class="math inline">{X_{M+1}, Y_{M+1}, Z_{M+1}; \dots; X_n, Y_n, Z_n}</span> represents measurements that converge in distribution as <span class="math inline">n \rightarrow \infty</span> to the unique, stationary distribution <span class="math inline">\pi</span>, that is <span class="math inline">p_{X,Y,Z}(\cdot)</span>&nbsp;<span class="citation" data-cites="Spall2005"><sup><a href="#ref-Spall2005" role="doc-biblioref">1</a></sup></span>.</p>
<p>Finally, the Gibbs sequence results considering the burn-in are substituded into the following equation to give <span class="math inline">E[f(X,Y,Z)]</span></p>
<p><span class="math display">
\frac{1}{n-M} \sum_{k = M+1}^n\ f(\mathbf{X}_k)
</span></p>
<p>Notice that samplings for <span class="math inline">X</span>, <span class="math inline">Y</span>, and <span class="math inline">Z</span> will converge to their respective marginal distributions, <span class="math inline">p_X(x)</span>, <span class="math inline">p_Y(y)</span>, and <span class="math inline">p_Z(z)</span>; see Section 7.1.3 from <em>Monte Carlo Statistical Methods</em> by Robert and Casella&nbsp;<span class="citation" data-cites="Spall2005 Robert2004"><sup><a href="#ref-Spall2005" role="doc-biblioref">1</a>,<a href="#ref-Robert2004" role="doc-biblioref">6</a></sup></span>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Variations that make the Gibbs sequence resemble i.i.d.
</div>
</div>
<div class="callout-body-container callout-body">
<p>The procedure we have detailed here to estimate the distribution using the collected Gibbs sequence is one of several methods. As might be expected, successive samples drawn from the Markov chain are highly correlated with one another&nbsp;<span class="citation" data-cites="Bishop2006"><sup><a href="#ref-Bishop2006" role="doc-biblioref">5</a></sup></span>. Different approaches are applied if it is desirable to make the values more i.i.d. You can learn more about some of these techniques in <em>Introduction to Stochastic Search and Optimization: Estimation, Simulation, and Control</em>, Section 16.3 <em>Gibbs Sampling</em> by Spall&nbsp;<span class="citation" data-cites="Spall2005"><sup><a href="#ref-Spall2005" role="doc-biblioref">1</a></sup></span>.</p>
</div>
</div>
<p>Because we are drawing from the conditioned factors of the target distribution, this makes Gibbs sampling less generalizable than M-H, but it comes with advantageous trade-offs. For instance, drawing directly from the target distribution itself ensures that detailed balance is already satisfied, and the algorithm is expected to be more efficient because the new point is always accepted&nbsp;<span class="citation" data-cites="Spall2005 Bishop2006 Koller2009"><sup><a href="#ref-Spall2005" role="doc-biblioref">1</a>,<a href="#ref-Koller2009" role="doc-biblioref">2</a>,<a href="#ref-Bishop2006" role="doc-biblioref">5</a></sup></span>.</p>
<p>It is helpful to see the process illustrated for a simpler case, but for completeness, it’s important to know how this extends to a generalized representation. The following is the generalized definition provided by Spall&nbsp;<span class="citation" data-cites="Spall2005"><sup><a href="#ref-Spall2005" role="doc-biblioref">1</a></sup></span>. Say that <span class="math inline">\mathbf{X}</span> is a collection of <span class="math inline">m</span> univariate components, then the <span class="math inline">k^{th}</span> sample from <span class="math inline">X</span> using the previous algorithm is</p>
<p><span class="math display">
\mathbf{X}_k = \left[ \begin{array}{c}
X_{k1} \\
X_{k2} \\
\vdots \\
X_{km}
\end{array} \right]
</span></p>
<p>where <span class="math inline">X_{ki}</span> is the <span class="math inline">i^{th}</span> component for the <span class="math inline">k^{th}</span> replicate of <span class="math inline">\mathbf{X}</span> that was generated using Gibbs sampling. Denote the step-wise updating results that have been conditioned on the previous samples by <span class="math inline">\{X_{k+1,\ i}\ \lvert\ \mathbf{X}_{k\backslash i}\}</span> where</p>
<p><span class="math display">
\mathbf{X}_{k\backslash i}\ \equiv \{X_{k+1,\ 1},\ X_{k+1,\ 2}, \dots, X_{k+1,\ i-1},\ X_{k,\ i+1} \dots,\ X_{k,\ km}\}
</span></p>
<p>for <span class="math inline">i = 1,\ 2, \dots,\ m</span>. Use <span class="math inline">{X_{k+1,\ i} \mid \mathbf{X}{k\backslash i}} \sim p_i(x \mid \mathbf{X}{k\backslash i})</span> to represent the sampling density for that random variable conditioned on the current elements of the Gibbs sequence, where <span class="math inline">i-1</span> elements are sample points at iteration <span class="math inline">k+1</span> and the remaining <span class="math inline">m-i</span> elements are from the <span class="math inline">k^{th}</span> iteration. The Gibbs sampling algorithm is as follows:</p>
<ol type="1">
<li><p>(<strong>Initialization</strong>) Choose the length of the burn-in, <span class="math inline">M</span>, and some arbitrary initial state <span class="math inline">\mathbf{X}_0</span> with <span class="math inline">k=0</span>.</p></li>
<li><p>Generate <span class="math inline">\mathbf{X}_{k+1}</span> by recursively updating the conditionals for each new sampling of a given variable.</p>
<ol type="1">
<li>Generate <span class="math inline">X_{k+1,\ 1} \sim p_1(x\ \lvert\ \mathbf{X}_{k\backslash 1})</span></li>
<li>Generate <span class="math inline">X_{k+1,\ 2} \sim p_2(x\ \lvert\ \mathbf{X}_{k\backslash 2})</span></li>
</ol>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="math inline">\vdots</span></p>
<ol start="13" type="a">
<li>Generate <span class="math inline">X_{k+1,\ m} \sim p_m(x\ \lvert\ \mathbf{X}_{k\backslash m})</span></li>
</ol></li>
<li><p>Repeat step 2 until the burn-in is reached. Set <span class="math inline">\mathbf{X}_k = \mathbf{X}_M</span> and continue with the procedure laid out in step 2, storing or recursively averaging the results as they are sampled.</p></li>
<li><p>When it is possible to compute the ergodic average (i.e.&nbsp;sufficient convergence is observed), then estimate <span class="math inline">E[f(\mathbf{X})]</span> for the target distribution <span class="math inline">p(\cdot)</span>.</p></li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Extension to the multivariate case
</div>
</div>
<div class="callout-body-container callout-body">
<p>We are only focusing on the typical case where <span class="math inline">X_{ki}</span> is scalar (i.e., all components of <span class="math inline">X</span> are univariate). It is sometimes applicable to make them multivariate. Students who wish to explore this further are encouraged to review example 16.7 <em>Variance-components model</em> from Section 16.6 <em>Applications in Bayesian Analysis</em> in Spall’s <em>Introduction to Stochastic Search and Optimization: Estimation, Simulation, and Control</em>&nbsp;<span class="citation" data-cites="Spall2005"><sup><a href="#ref-Spall2005" role="doc-biblioref">1</a></sup></span>.</p>
</div>
</div>
<p>When sampling from the conditional distribution is challenging or requires excessive computational power, the conditional properties associated with a distribution network graph can help&nbsp;<span class="citation" data-cites="Koller2009"><sup><a href="#ref-Koller2009" role="doc-biblioref">2</a></sup></span>. Depending on the type of associations defined, it might be possible to isolate variables from the rest of the network using its independence structures, assuming that these assertions are reasonably correct.</p>
<p>For an undirected Markov network, this would involve isolating nodes contained within a Markov blanket. In directed graphs, nodes conditioned on their parents can lead to log-concave Gibbs sampling distributions. If these conditional distributions are log-concave, alternative sampling methods, such as the aforementioned adaptive rejection sampling method, can be used within the Gibbs sampling framework&nbsp;<span class="citation" data-cites="Bishop2006 Robert2004"><sup><a href="#ref-Bishop2006" role="doc-biblioref">5</a>,<a href="#ref-Robert2004" role="doc-biblioref">6</a></sup></span>.</p>
<p>With this fundamental understanding of Gibbs sampling of Markov chains, we are now better prepared to explore hierarchical modeling of our data.</p>
</section>
</section>
<section id="hierarchical-modeling" class="level2">
<h2 class="anchored" data-anchor-id="hierarchical-modeling">Hierarchical Modeling</h2>
<p>Gibbs sampling is inherently suited to address multivariate problems because it breaks a high-dimensional vector into lower-dimensional component blocks&nbsp;<span class="citation" data-cites="Spall2005"><sup><a href="#ref-Spall2005" role="doc-biblioref">1</a></sup></span>.</p>
</section>
<section id="set-up-the-environment" class="level2">
<h2 class="anchored" data-anchor-id="set-up-the-environment">Set Up the Environment</h2>
<section id="installing-jags" class="level3">
<h3 class="anchored" data-anchor-id="installing-jags">Installing JAGS</h3>
<p>The <code>rjags</code> package requires <a href="https://mcmc-jags.sourceforge.io/">JAGS</a> to be installed separately. <code>rjags</code> will reference the JAGS <code>libjags.4.dylib</code> library file and the <code>modules-4</code> directory, which contains seven <code>*.so</code> files, such as <code>bugs.so.</code> The next steps will walk you through installation, and an optional troubleshooting guide if R cannot find the JAGS file path.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Mac</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">PC</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<ol type="1">
<li><p>From <a href="https://mcmc-jags.sourceforge.io/">JAGS</a>, open the download link that will take you to a SourceForge page.</p></li>
<li><p>Download the latest version. At the time of this writing, the current version is JAGS-4.3.2.</p></li>
<li><p>Open and run the downloaded installer.</p></li>
<li><p>Confirm that the installation is located where we need it to be: <code>/usr/local/lib/</code>.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Command-Line Application</strong></pre>
</div>
<div class="sourceCode" id="cb1" data-filename="Command-Line Application"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Running both should NOT give you "No such file or directory"</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-l</span> /usr/local/lib/libjags.4.dylib</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-l</span> /usr/local/lib/JAGS/modules-4/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
If the namespace load failed
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Sometimes, the installer might place the JAGS program in a different location. For example, if you installed JAGS using Homebrew, the program might have been placed in the Homebrew library. If the file path differs, you will need to adjust the following code accordingly before reinstalling it in R.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Command-Line Application</strong></pre>
</div>
<div class="sourceCode" id="cb2" data-filename="Command-Line Application"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This example assumes that Homebrew was used</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">brew</span> install jags</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li><p>Open <code>/usr/local/lib</code> by searching for it with “Go to Folder” in an open Finder Window. If it does not already exist, create the file path using the following code.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Command-Line Application</strong></pre>
</div>
<div class="sourceCode" id="cb3" data-filename="Command-Line Application"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ONLY IF there is no existing directory</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> mkdir <span class="at">-p</span> /usr/local/lib</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>Create a symbolic link from the Homebrew-installed <code>libjags.4.dylib</code> JAGS library to the expected location:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Command-Line Application</strong></pre>
</div>
<div class="sourceCode" id="cb4" data-filename="Command-Line Application"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> ln <span class="at">-s</span> /opt/homebrew/lib/libjags.4.dylib /usr/local/lib/libjags.4.dylib</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>Create another symbolic link for the Homebrew-installed JAGS modules directory to the expected location:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Command-Line Application</strong></pre>
</div>
<div class="sourceCode" id="cb5" data-filename="Command-Line Application"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> mkdir <span class="at">-p</span> /usr/local/lib/JAGS/modules-4</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> ln <span class="at">-s</span> /opt/homebrew/lib/JAGS/modules-4/<span class="pp">*</span> /usr/local/lib/JAGS/modules-4/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p><strong>OPTIONAL:</strong> You can verify the linking worked if you see the intended directory listed for both of the following lines of code.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Command-Line Application</strong></pre>
</div>
<div class="sourceCode" id="cb6" data-filename="Command-Line Application"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Running both should NOT give you "No such file or directory"</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-l</span> /usr/local/lib/libjags.4.dylib</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-l</span> /usr/local/lib/JAGS/modules-4/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>Reinstalling rjags with the connection in place.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>RStudio</strong></pre>
</div>
<div class="sourceCode" id="cb7" data-filename="RStudio"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove existing installation</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">remove.packages</span>(<span class="st">"rjags"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Reinstall rjags</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"rjags"</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the package</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rjags)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ol>
</div>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This page was developed on a Mac, and so the directions for a PC were not able to be tested.</p>
</div>
</div>
<ol type="1">
<li><p>From <a href="https://mcmc-jags.sourceforge.io/">JAGS</a>, open the download link that will take you to a SourceForge page.</p></li>
<li><p>Download the latest version. At the time of this writing, the current version is JAGS-4.3.2.</p></li>
<li><p>Open and run the downloaded installer.</p></li>
<li><p>You will need to also download the latest version of <a href="https://cran.r-project.org/bin/windows/Rtools/">RTools</a>, which at the time of this writing is RTools 4.5. Add <code>Rtools</code> to your <code>PATH</code> if it is not done automatically.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Command-Line Application</strong></pre>
</div>
<div class="sourceCode" id="cb8" data-filename="Command-Line Application"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">where</span> make   <span class="co"># Should give the result "C:\Rtools\bin\make.exe"</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> %PATH%  <span class="co"># Should give the result "C:\Rtools\bin;C:\Rtools\mingw_64\bin"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If this does not give the expected results, you can set the path:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Command-Line Application</strong></pre>
</div>
<div class="sourceCode" id="cb9" data-filename="Command-Line Application"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ONLY IF the PATH for Rtools is incorrect.</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="ex">setx</span> PATH <span class="st">"%PATH%;C:\Rtools\bin;C:\Rtools\mingw_64\bin"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>Confirm that the installation is located where we need it to be: <code>C:\Program Files\JAGS\JAGS-4.x\bin</code>.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Command-Line Application</strong></pre>
</div>
<div class="sourceCode" id="cb10" data-filename="Command-Line Application"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> %JAGS_HOME%  <span class="co"># Should say "C:\Program Files\JAGS\JAGS-4.x"</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> %PATH%       <span class="co"># Should say "...;C:\Program Files\JAGS\JAGS-4.x\bin;..."</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
If the namespace load failed
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Sometimes the installer might place the JAGS program in a different location. If this happens, you can set the file path in the command line application as follows and retry installing the package through R.</p>
<ol type="1">
<li><p>Modify the environment variables as needed.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Command-Line Application</strong></pre>
</div>
<div class="sourceCode" id="cb11" data-filename="Command-Line Application"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">setx</span> JAGS_HOME <span class="st">"C:\Program Files\JAGS\JAGS-4.x"</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">setx</span> PATH <span class="st">"%PATH%;C:\Program Files\JAGS\JAGS-4.x\bin"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p><strong>OPTIONAL:</strong> You can verify the setting worked.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Command-Line Application</strong></pre>
</div>
<div class="sourceCode" id="cb12" data-filename="Command-Line Application"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> %JAGS_HOME%  <span class="co"># Should say "C:\Program Files\JAGS\JAGS-4.x"</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> %PATH%       <span class="co"># Should say "...;C:\Program Files\JAGS\JAGS-4.x\bin;..."</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
<li><p>Reinstalling rjags with the connection in place.</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>RStudio</strong></pre>
</div>
<div class="sourceCode" id="cb13" data-filename="RStudio"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove existing installation</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">remove.packages</span>(<span class="st">"rjags"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Reinstall rjags</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"rjags"</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the package</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rjags)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<p>With JAGS installed, we can now proceed with the standard process of installing the necessary packages. If you have not done so already, you will need to initialize the project’s <code>renv</code> lockfile to ensure that the same package versions are installed in the project’s local package library.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>RStudio</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">init</span>()      <span class="co"># Initialize the project     </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">restore</span>()   <span class="co"># Download packages and their version saved in the lockfile</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>RStudio</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(<span class="st">"readr"</span>)      <span class="co"># For reading in the data</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(<span class="st">"tibble"</span>)     <span class="co"># For handling tidyverse tibble data classes</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(<span class="st">"tidyr"</span>)      <span class="co"># For tidying data </span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(<span class="st">"dplyr"</span>)      <span class="co"># For data manipulation </span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(<span class="st">"stringr"</span>)    <span class="co"># For string manipulation</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(<span class="st">"MASS"</span>)       <span class="co"># Functions/datasets for statistical analysis</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(<span class="st">"lubridate"</span>)  <span class="co"># For date manipulation</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(<span class="st">"ggplot2"</span>)    <span class="co"># For creating static visualizations</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(<span class="st">"viridis"</span>)    <span class="co"># For color scales in ggplot2</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(<span class="st">"scales"</span>)     <span class="co"># For formatting plots axis</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(<span class="st">"gridExtra"</span>)  <span class="co"># Creates multiple grid-based plots</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(<span class="st">"rjags"</span>)      <span class="co"># For running JAGS (Just Another Gibbs Sampler) models</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(<span class="st">"coda"</span>)       <span class="co"># For analysis of MCMC output from Bayesian models</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to select "Not In"</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="st">'%!in%'</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(x,y)<span class="sc">!</span>(<span class="st">'%in%'</span>(x,y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>To demonstrate hierarchical modeling using Gibbs sampling to estimate the distribution, we are going to examine the data and results from <em>Potential Impact of Higher-Valency Pneumococcal Conjugate Vaccines Among Adults in Different Localities in Germany</em> by Ellingson et al&nbsp;<span class="citation" data-cites="Ellingson2023"><sup><a href="#ref-Ellingson2023" role="doc-biblioref">10</a></sup></span>.</p>
<p>The data comes from surveillance for invasive pneumococcal disease (IPD) conducted by the German National Reference Center for Streptococci (GRNCS), which collects voluntarily reported microbial diagnostic lab results and is expected to account for 50% of all IPD in Germany. Serotyping is done by GNRCS using the samples provided by these laboratories, and incidences are reported as cases per 100,000 using the age-specific population in Germany in 2018&nbsp;<span class="citation" data-cites="Ellingson2023"><sup><a href="#ref-Ellingson2023" role="doc-biblioref">10</a></sup></span>.</p>
<div class="scrollable-output">
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in the cleaned data directly from the instructor's GitHub.</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://raw.githubusercontent.com/ysph-dsde/bdsy-phm/refs/heads/main/Data/testDE2.csv"</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize the variable names included in the dataset.</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "...1"                             "Sequencial.number"               
 [3] "Study"                            "Number"                          
 [5] "Inclusion"                        "DateOfIsolation"                 
 [7] "DateOfBirth"                      "AgeInYears"                      
 [9] "AgeinMonths"                      "Postleitzahl.patient"            
[11] "Zip"                              "Federal.state.patient"           
[13] "Residence.patient"                "Country.patient"                 
[15] "SeroType"                         "Strain.identification...Genus"   
[17] "Strain.identification...Species"  "Pneumonia"                       
[19] "MD.Amoxicillin"                   "AmoxicillinSNS"                  
[21] "MD.Cefotaxime"                    "CefotaximeSNS"                   
[23] "MD.Chloramphenicol"               "ChloramphenicolSNS"              
[25] "MD.Clindamycin"                   "ClindamycinSNS"                  
[27] "MD.Erythromycin"                  "ErythromycinSNS"                 
[29] "MD.Levofloxacin"                  "LevofloxaxinSNS"                 
[31] "MD.Penicillin"                    "PenicillinSNS"                   
[33] "MD.Tetracyclin"                   "TetracyclineSNS"                 
[35] "MD.Trimetoprim.Sulfamethoxazole"  "Sulfamethoxazole.trimethoprimSNS"
[37] "MD.Vancomycin"                    "VancomycinSNS"                   
[39] "date"                             "year"                            
[41] "month"                            "epiyr"                           
[43] "agec"                             "vt"                              
[45] "vaxperiod"                        "zip2"                            
[47] "indic"                           </code></pre>
</div>
</div>
</div>
<p>The dataset includes a lot of information that is not required for our analysis today. We will, therefore, focus only on the variables used in the hierarchical model itself.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize aspects and dimentions of our dataset.</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(df[, <span class="fu">c</span>(<span class="dv">39</span><span class="sc">:</span><span class="dv">42</span>, <span class="dv">45</span>, <span class="dv">8</span>, <span class="dv">15</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 17,653
Columns: 7
$ date       &lt;date&gt; 2003-01-15, 2003-01-15, 2003-01-15, 2003-01-15, 2003-01-15…
$ year       &lt;dbl&gt; 2003, 2003, 2003, 2003, 2003, 2003, 2003, 2003, 2003, 2003,…
$ month      &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ epiyr      &lt;dbl&gt; 2002, 2002, 2002, 2002, 2002, 2002, 2002, 2002, 2002, 2002,…
$ vaxperiod  &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ AgeInYears &lt;dbl&gt; 40, 63, 77, 74, 84, 89, 79, 53, 73, 42, 50, 69, 71, 72, 40,…
$ SeroType   &lt;chr&gt; "1", "3", "4", "19F", "14", "7F", "7C", "12F", "4", "4", "5…</code></pre>
</div>
</div>
</section>
<section id="data-dictionary" class="level3">
<h3 class="anchored" data-anchor-id="data-dictionary">Data Dictionary</h3>
<p>This paper did not explicitly describe each variable in a “Data Dictionary”. The following was assembled based on the context and methods provided in the paper, other like papers by the same authors, and its supplementary materials&nbsp;<span class="citation" data-cites="Ellingson2023 Perniciaro2022"><sup><a href="#ref-Ellingson2023" role="doc-biblioref">10</a>,<a href="#ref-Perniciaro2022" role="doc-biblioref">11</a></sup></span>.</p>
<ul>
<li><p><strong>date:</strong> The date when the events were recorded. It is not clear if this is the date GNRCS received the samples or when they were collected at the participating lab.</p></li>
<li><p><strong>year:</strong> The year from the date column.</p></li>
<li><p><strong>month:</strong> The month from the date column.</p></li>
<li><p><strong>epiyr:</strong> The epidemiological year of the observation (<a href="https://ndc.services.cdc.gov/wp-content/uploads/MMWR_week_overview.pdf">MMWR definition</a>)&nbsp;<span class="citation" data-cites="mmwr_cdc"><sup><a href="#ref-mmwr_cdc" role="doc-biblioref">12</a></sup></span>.</p></li>
<li><p><strong>vaxperiod:</strong> Numerical encoding differentiating years where the PCV vaccine recommendations differed, with approximately a one-year latency time built in. It is not clear what each phase denotes, but based on other papers by the same authors, they appear to mean&nbsp;<span class="citation" data-cites="Perniciaro2022"><sup><a href="#ref-Perniciaro2022" role="doc-biblioref">11</a></sup></span>:</p>
<ul>
<li><code>vaxperiod = 1</code> The period before Germany instituted its recommendation for all infants to receive 4 PCV doses in July 2006. The specific formula was not enforced and could either have been the 10-valent or 13-valent PCV. Spans 2001 to 2007.</li>
<li><code>vaxperiod = 2</code> The period following introduction of PCV in infants in 2006 and before the updated recommendation for infants to receive 2 primary doses and a booster dose. Spans 2007 to 2015.</li>
<li><code>vaxperiod = 3</code> The period following the updated recommendation in 2015. Spans 2015 to 2018.</li>
<li><strong>NOTE:</strong> 2019 is the last year reported in the dataset an was not assigned to any vaccine period.</li>
</ul></li>
<li><p><strong>AgeInYears:</strong> The age of the patient from which the same was collected.</p></li>
<li><p><strong>SeroType:</strong> The serotype of the pathogen identified using capsular swelling with the full antiserum.</p></li>
</ul>
<ol type="1">
<li>Aggregating the data to count the number of cases for each serotype-year combination.</li>
<li>Ensuring that all possible serotype-year combinations are represented.</li>
<li>Creating numeric IDs for <code>SeroType</code> and <code>epiyr.</code></li>
<li>Creating a list of data objects required for running the JAGS model, including case counts, numeric IDs, and the number of unique serotypes and years.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate the data by SeroType and epiyr to get the number of cases </span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># for each combination. The function complete() ensures all combinations </span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># of SeroType and epiyr are represented in the dataset, even those with </span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># zero cases.</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>serotype_year_counts <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(SeroType, epiyr, <span class="at">name =</span> <span class="st">"cases"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(SeroType, epiyr, <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">cases =</span> <span class="dv">0</span>))</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the categorical variables SeroType and epiyr into numeric IDs </span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co"># which are easier to work with in JAGS.</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>serotype_year_counts <span class="ot">&lt;-</span> serotype_year_counts <span class="sc">%&gt;%</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sero_id =</span> <span class="fu">as.integer</span>(<span class="fu">factor</span>(SeroType)),</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">year_id =</span> <span class="fu">as.integer</span>(<span class="fu">factor</span>(epiyr)))</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the data list that will be input into JAGS.</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>jdat <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">nrow</span>(serotype_year_counts),</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">cases =</span> serotype_year_counts<span class="sc">$</span>cases,</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">sero_id =</span> serotype_year_counts<span class="sc">$</span>sero_id,</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">year_id =</span> serotype_year_counts<span class="sc">$</span>year_id,</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_sero =</span> <span class="fu">length</span>(<span class="fu">unique</span>(serotype_year_counts<span class="sc">$</span>sero_id)),</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_year =</span> <span class="fu">length</span>(<span class="fu">unique</span>(serotype_year_counts<span class="sc">$</span>year_id))</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"Model2.R"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">jags.model</span>(<span class="fu">textConnection</span>(jcode), <span class="at">data =</span> jdat, <span class="at">n.chains =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Compiling model graph
   Resolving undeclared variables
   Allocating nodes
Graph information:
   Observed stochastic nodes: 1577
   Unobserved stochastic nodes: 166
   Total graph size: 9656

Initializing model</code></pre>
</div>
</div>
<div class="scrollable-output">
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">update</span>(mod, <span class="dv">1000</span>)  <span class="co"># burn-in</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>samp <span class="ot">&lt;-</span> <span class="fu">coda.samples</span>(mod, <span class="at">variable.names =</span> <span class="fu">c</span>(<span class="st">"mu"</span>, <span class="st">"beta"</span>), <span class="at">n.iter =</span> <span class="dv">5000</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(samp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Iterations = 2001:7000
Thinning interval = 1 
Number of chains = 2 
Sample size per chain = 5000 

1. Empirical mean and standard deviation for each variable,
   plus standard error of the mean:

               Mean        SD  Naive SE Time-series SE
beta[1]  -8.483e-03  0.007019 7.019e-05      9.277e-05
beta[2]   1.308e-01  0.009273 9.273e-05      1.657e-04
beta[3]   1.359e-01  0.045234 4.523e-04      8.893e-04
beta[4]   8.522e-03  0.100215 1.002e-03      1.326e-03
beta[5]   1.253e-01  0.009906 9.906e-05      1.816e-04
beta[6]   7.451e-02  0.082080 8.208e-04      1.263e-03
beta[7]  -5.324e-02  0.120523 1.205e-03      1.697e-03
beta[8]   1.394e-01  0.041883 4.188e-04      7.871e-04
beta[9]  -8.979e-02  0.156193 1.562e-03      2.769e-03
beta[10]  1.788e-01  0.008002 8.002e-05      1.903e-04
beta[11]  1.040e-01  0.045346 4.535e-04      7.570e-04
beta[12] -4.639e-02  0.007302 7.302e-05      9.706e-05
beta[13]  2.028e-01  0.012658 1.266e-04      3.163e-04
beta[14]  1.425e-01  0.014258 1.426e-04      2.809e-04
beta[15]  1.496e-01  0.019428 1.943e-04      3.753e-04
beta[16]  1.049e-01  0.073125 7.313e-04      1.231e-03
beta[17]  2.026e-01  0.019338 1.934e-04      4.996e-04
beta[18]  2.730e+00  1.349469 1.349e-02      2.377e-01
beta[19]  1.707e-01  0.019377 1.938e-04      4.194e-04
beta[20] -1.677e-01  0.255076 2.551e-03      5.455e-03
beta[21]  1.159e-01  0.035792 3.579e-04      6.357e-04
beta[22]  1.424e-01  0.170356 1.704e-03      3.485e-03
beta[23]  1.213e-02  0.014501 1.450e-04      1.757e-04
beta[24] -1.706e-01  0.174780 1.748e-03      3.891e-03
beta[25]  1.008e-01  0.005811 5.811e-05      9.625e-05
beta[26]  2.733e-01  0.313562 3.136e-03      1.101e-02
beta[27] -3.557e-01  0.343016 3.430e-03      1.437e-02
beta[28]  5.292e-02  0.009806 9.806e-05      1.288e-04
beta[29]  1.563e-01  0.015261 1.526e-04      3.191e-04
beta[30]  2.870e-01  0.076889 7.689e-04      2.790e-03
beta[31]  2.947e-02  0.087817 8.782e-04      1.167e-03
beta[32] -1.730e-01  0.175933 1.759e-03      4.172e-03
beta[33]  1.451e-01  0.006552 6.552e-05      1.300e-04
beta[34]  1.631e-01  0.010698 1.070e-04      2.258e-04
beta[35]  3.468e-01  0.343361 3.434e-03      1.416e-02
beta[36]  2.033e-01  0.012476 1.248e-04      3.082e-04
beta[37] -1.837e-01  0.267050 2.671e-03      6.534e-03
beta[38] -1.938e-02  0.011096 1.110e-04      1.497e-04
beta[39]  1.035e-01  0.104606 1.046e-03      1.731e-03
beta[40]  4.075e-02  0.117601 1.176e-03      1.562e-03
beta[41]  1.514e-01  0.011260 1.126e-04      2.273e-04
beta[42]  1.236e-02  0.112506 1.125e-03      1.457e-03
beta[43] -6.543e-03  0.097496 9.750e-04      1.247e-03
beta[44]  1.329e+00  0.820724 8.207e-03      9.366e-02
beta[45]  3.302e+00  2.113212 2.113e-02      6.809e-01
beta[46]  1.784e-01  0.033175 3.318e-04      7.319e-04
beta[47]  1.937e-01  0.056789 5.679e-04      1.442e-03
beta[48]  9.835e-03  0.067714 6.771e-04      8.771e-04
beta[49]  1.412e-01  0.004052 4.052e-05      8.133e-05
beta[50]  1.739e-01  0.016660 1.666e-04      3.786e-04
beta[51] -1.340e-01  0.057368 5.737e-04      1.157e-03
beta[52] -1.100e-01  0.155505 1.555e-03      2.787e-03
beta[53]  1.334e-01  0.012897 1.290e-04      2.393e-04
beta[54]  1.378e-01  0.023408 2.341e-04      4.435e-04
beta[55]  7.706e-02  0.066855 6.686e-04      1.002e-03
beta[56]  1.901e-01  0.017320 1.732e-04      4.117e-04
beta[57]  4.464e-02  0.058435 5.844e-04      7.961e-04
beta[58]  1.536e-01  0.013067 1.307e-04      2.560e-04
beta[59]  1.646e-01  0.050787 5.079e-04      1.087e-03
beta[60]  1.614e-01  0.015284 1.528e-04      3.200e-04
beta[61]  8.092e-04  0.235790 2.358e-03      3.175e-03
beta[62]  3.612e-03  0.008478 8.478e-05      1.061e-04
beta[63] -5.305e-02  0.043966 4.397e-04      6.163e-04
beta[64]  4.906e-03  0.010861 1.086e-04      1.416e-04
beta[65] -1.046e-01  0.241791 2.418e-03      4.446e-03
beta[66] -2.649e-02  0.014401 1.440e-04      1.909e-04
beta[67] -1.118e-01  0.239106 2.391e-03      4.219e-03
beta[68]  1.269e-01  0.010858 1.086e-04      1.980e-04
beta[69]  1.960e-01  0.110487 1.105e-03      2.723e-03
beta[70]  5.629e-02  0.234695 2.347e-03      3.477e-03
beta[71] -1.911e-01  0.277531 2.775e-03      7.445e-03
beta[72]  6.687e-02  0.150299 1.503e-03      2.264e-03
beta[73]  3.648e-01  0.080818 8.082e-04      3.732e-03
beta[74]  1.200e-01  0.043146 4.315e-04      7.646e-04
beta[75]  2.015e-02  0.005652 5.652e-05      7.236e-05
beta[76]  2.044e-01  0.007633 7.633e-05      2.090e-04
beta[77] -4.894e-02  0.073670 7.367e-04      1.002e-03
beta[78] -4.762e-02  0.073647 7.365e-04      1.037e-03
beta[79]  1.650e-01  0.008248 8.248e-05      1.861e-04
beta[80]  8.492e-04  0.227673 2.277e-03      2.969e-03
beta[81] -3.284e-02  0.010875 1.087e-04      1.442e-04
beta[82]  1.724e-01  0.046703 4.670e-04      1.014e-03
beta[83]  2.963e-01  0.227647 2.276e-03      8.236e-03
mu[1]     3.598e+00  0.038032 3.803e-04      4.787e-04
mu[2]     3.046e+00  0.055711 5.571e-04      1.036e-03
mu[3]    -1.195e-01  0.273970 2.740e-03      5.302e-03
mu[4]    -1.837e+00  0.578810 5.788e-03      9.301e-03
mu[5]     2.963e+00  0.058452 5.845e-04      1.046e-03
mu[6]    -1.412e+00  0.477669 4.777e-03      7.838e-03
mu[7]    -2.263e+00  0.698987 6.990e-03      1.164e-02
mu[8]     2.702e-03  0.254833 2.548e-03      4.873e-03
mu[9]    -2.906e+00  0.986986 9.870e-03      2.120e-02
mu[10]    3.379e+00  0.050233 5.023e-04      1.170e-03
mu[11]   -1.591e-01  0.261546 2.615e-03      4.529e-03
mu[12]    3.494e+00  0.041185 4.118e-04      5.564e-04
mu[13]    2.435e+00  0.080798 8.080e-04      2.040e-03
mu[14]    2.198e+00  0.085242 8.524e-04      1.671e-03
mu[15]    1.539e+00  0.117493 1.175e-03      2.321e-03
mu[16]   -1.150e+00  0.431392 4.314e-03      7.537e-03
mu[17]    1.656e+00  0.122777 1.228e-03      3.203e-03
mu[18]   -2.528e+01 11.942995 1.194e-01      2.107e+00
mu[19]    1.565e+00  0.120775 1.208e-03      2.576e-03
mu[20]   -4.436e+00  1.733684 1.734e-02      4.356e-02
mu[21]    3.288e-01  0.209567 2.096e-03      3.740e-03
mu[22]   -3.085e+00  1.085627 1.086e-02      2.491e-02
mu[23]    2.135e+00  0.078122 7.812e-04      1.030e-03
mu[24]   -3.206e+00  1.153488 1.153e-02      2.953e-02
mu[25]    3.946e+00  0.033369 3.337e-04      5.251e-04
mu[26]   -4.981e+00  2.355240 2.355e-02      9.419e-02
mu[27]   -5.415e+00  2.576061 2.576e-02      1.145e-01
mu[28]    2.911e+00  0.054746 5.475e-04      7.323e-04
mu[29]    2.124e+00  0.092356 9.236e-04      1.983e-03
mu[30]   -1.253e+00  0.530140 5.301e-03      1.960e-02
mu[31]   -1.558e+00  0.499864 4.999e-03      7.467e-03
mu[32]   -3.195e+00  1.152536 1.153e-02      3.006e-02
mu[33]    3.799e+00  0.039582 3.958e-04      8.103e-04
mu[34]    2.781e+00  0.065748 6.575e-04      1.382e-03
mu[35]   -5.342e+00  2.589064 2.589e-02      1.224e-01
mu[36]    2.462e+00  0.080159 8.016e-04      2.028e-03
mu[37]   -4.528e+00  1.873174 1.873e-02      5.286e-02
mu[38]    2.642e+00  0.061286 6.129e-04      7.579e-04
mu[39]   -1.971e+00  0.631519 6.315e-03      1.172e-02
mu[40]   -2.234e+00  0.698795 6.988e-03      1.125e-02
mu[41]    2.680e+00  0.069561 6.956e-04      1.389e-03
mu[42]   -2.190e+00  0.672194 6.722e-03      1.015e-02
mu[43]   -1.821e+00  0.565775 5.658e-03      8.804e-03
mu[44]   -1.307e+01  7.051681 7.052e-02      8.196e-01
mu[45]   -3.044e+01 18.892164 1.889e-01      6.038e+00
mu[46]    4.867e-01  0.209065 2.091e-03      4.598e-03
mu[47]   -5.633e-01  0.362765 3.628e-03      9.608e-03
mu[48]   -1.005e+00  0.378434 3.784e-03      5.465e-03
mu[49]    4.707e+00  0.024094 2.409e-04      4.707e-04
mu[50]    1.927e+00  0.103311 1.033e-03      2.317e-03
mu[51]   -6.268e-01  0.349487 3.495e-03      6.904e-03
mu[52]   -2.942e+00  0.984873 9.849e-03      2.041e-02
mu[53]    2.385e+00  0.077542 7.754e-04      1.450e-03
mu[54]    1.204e+00  0.142713 1.427e-03      2.743e-03
mu[55]   -9.457e-01  0.380660 3.807e-03      6.346e-03
mu[56]    1.837e+00  0.109253 1.093e-03      2.490e-03
mu[57]   -6.675e-01  0.323598 3.236e-03      4.620e-03
mu[58]    2.375e+00  0.079230 7.923e-04      1.525e-03
mu[59]   -4.311e-01  0.318256 3.183e-03      6.938e-03
mu[60]    2.089e+00  0.092807 9.281e-04      1.925e-03
mu[61]   -4.144e+00  1.534024 1.534e-02      3.167e-02
mu[62]    3.201e+00  0.045824 4.582e-04      6.104e-04
mu[63]   -9.921e-02  0.243202 2.432e-03      3.776e-03
mu[64]    2.665e+00  0.059689 5.969e-04      7.534e-04
mu[65]   -4.224e+00  1.647465 1.647e-02      3.928e-02
mu[66]    2.121e+00  0.078352 7.835e-04      1.020e-03
mu[67]   -4.222e+00  1.554470 1.554e-02      3.424e-02
mu[68]    2.728e+00  0.064233 6.423e-04      1.140e-03
mu[69]   -2.052e+00  0.721714 7.217e-03      1.876e-02
mu[70]   -4.167e+00  1.581742 1.582e-02      3.253e-02
mu[71]   -4.589e+00  1.988992 1.989e-02      5.875e-02
mu[72]   -2.851e+00  0.905025 9.050e-03      1.668e-02
mu[73]   -1.379e+00  0.590243 5.902e-03      2.819e-02
mu[74]   -1.881e-02  0.253284 2.533e-03      4.602e-03
mu[75]    3.988e+00  0.031245 3.124e-04      4.014e-04
mu[76]    3.484e+00  0.048766 4.877e-04      1.297e-03
mu[77]   -1.180e+00  0.416508 4.165e-03      6.124e-03
mu[78]   -1.174e+00  0.427212 4.272e-03      6.846e-03
mu[79]    3.321e+00  0.051078 5.108e-04      1.152e-03
mu[80]   -4.083e+00  1.507924 1.508e-02      2.886e-02
mu[81]    2.649e+00  0.061347 6.135e-04      8.565e-04
mu[82]   -2.215e-01  0.292863 2.929e-03      6.339e-03
mu[83]   -3.846e+00  1.637498 1.637e-02      6.577e-02

2. Quantiles for each variable:

               2.5%        25%        50%        75%     97.5%
beta[1]   -0.022158  -0.013201 -8.408e-03 -3.743e-03  0.005039
beta[2]    0.112838   0.124678  1.307e-01  1.369e-01  0.149457
beta[3]    0.049590   0.105373  1.345e-01  1.643e-01  0.227822
beta[4]   -0.193351  -0.055907  9.552e-03  7.344e-02  0.204556
beta[5]    0.105578   0.118672  1.253e-01  1.320e-01  0.144239
beta[6]   -0.081776   0.018846  7.227e-02  1.283e-01  0.242547
beta[7]   -0.295169  -0.129883 -4.970e-02  2.697e-02  0.178445
beta[8]    0.060939   0.111216  1.379e-01  1.662e-01  0.227395
beta[9]   -0.423770  -0.184143 -8.184e-02  1.166e-02  0.198572
beta[10]   0.163302   0.173428  1.788e-01  1.841e-01  0.194591
beta[11]   0.017879   0.072708  1.029e-01  1.333e-01  0.196431
beta[12]  -0.060938  -0.051327 -4.630e-02 -4.143e-02 -0.032075
beta[13]   0.178496   0.194187  2.027e-01  2.112e-01  0.227797
beta[14]   0.114301   0.133008  1.424e-01  1.520e-01  0.170848
beta[15]   0.112391   0.136340  1.493e-01  1.624e-01  0.188416
beta[16]  -0.031629   0.054778  1.030e-01  1.533e-01  0.256106
beta[17]   0.165695   0.189306  2.024e-01  2.154e-01  0.241310
beta[18]   0.414032   1.712929  2.563e+00  3.757e+00  5.358092
beta[19]   0.133128   0.157228  1.703e-01  1.841e-01  0.209222
beta[20]  -0.736909  -0.313719 -1.446e-01 -3.892e-05  0.283892
beta[21]   0.048239   0.091664  1.147e-01  1.394e-01  0.189779
beta[22]  -0.164050   0.025213  1.282e-01  2.443e-01  0.515988
beta[23]  -0.016204   0.002198  1.211e-02  2.194e-02  0.040699
beta[24]  -0.556835  -0.274872 -1.559e-01 -5.157e-02  0.137835
beta[25]   0.089418   0.096834  1.008e-01  1.048e-01  0.111968
beta[26]  -0.212766   0.062303  2.284e-01  4.296e-01  1.023660
beta[27]  -1.203848  -0.527417 -2.993e-01 -1.231e-01  0.166904
beta[28]   0.033754   0.046184  5.295e-02  5.953e-02  0.072197
beta[29]   0.126704   0.145906  1.563e-01  1.666e-01  0.186356
beta[30]   0.153587   0.233554  2.819e-01  3.348e-01  0.457911
beta[31]  -0.143712  -0.028467  2.840e-02  8.682e-02  0.203696
beta[32]  -0.569523  -0.276827 -1.590e-01 -5.375e-02  0.132273
beta[33]   0.132315   0.140667  1.451e-01  1.495e-01  0.158186
beta[34]   0.142870   0.155587  1.630e-01  1.702e-01  0.184567
beta[35]  -0.172471   0.116121  2.920e-01  5.140e-01  1.201293
beta[36]   0.178535   0.194615  2.032e-01  2.118e-01  0.227017
beta[37]  -0.802576  -0.332348 -1.545e-01 -6.294e-03  0.272860
beta[38]  -0.040849  -0.026856 -1.956e-02 -1.194e-02  0.002417
beta[39]  -0.090249   0.031939  9.780e-02  1.718e-01  0.319160
beta[40]  -0.189607  -0.036758  3.911e-02  1.167e-01  0.277665
beta[41]   0.129460   0.143804  1.513e-01  1.590e-01  0.173353
beta[42]  -0.208704  -0.061022  1.166e-02  8.559e-02  0.236248
beta[43]  -0.202722  -0.071449 -5.342e-03  5.870e-02  0.186490
beta[44]   0.110302   0.697005  1.208e+00  1.872e+00  3.162159
beta[45]   0.468618   1.749385  2.924e+00  4.322e+00  9.033387
beta[46]   0.116299   0.155526  1.771e-01  2.004e-01  0.246106
beta[47]   0.089740   0.154443  1.909e-01  2.291e-01  0.312192
beta[48]  -0.120899  -0.034603  8.292e-03  5.370e-02  0.146662
beta[49]   0.133368   0.138460  1.412e-01  1.439e-01  0.149007
beta[50]   0.141723   0.162541  1.739e-01  1.851e-01  0.206978
beta[51]  -0.253938  -0.171302 -1.316e-01 -9.426e-02 -0.028586
beta[52]  -0.449320  -0.204798 -9.945e-02 -6.416e-03  0.172100
beta[53]   0.108320   0.124533  1.332e-01  1.420e-01  0.158612
beta[54]   0.092954   0.122175  1.373e-01  1.532e-01  0.185496
beta[55]  -0.049302   0.031801  7.590e-02  1.212e-01  0.215022
beta[56]   0.156316   0.178194  1.897e-01  2.017e-01  0.224996
beta[57]  -0.067968   0.005312  4.321e-02  8.262e-02  0.163183
beta[58]   0.128514   0.144503  1.534e-01  1.622e-01  0.179765
beta[59]   0.070257   0.129072  1.626e-01  1.972e-01  0.269911
beta[60]   0.131061   0.151320  1.614e-01  1.717e-01  0.191311
beta[61]  -0.473028  -0.141666 -2.225e-03  1.451e-01  0.474377
beta[62]  -0.012813  -0.002101  3.564e-03  9.338e-03  0.020356
beta[63]  -0.143097  -0.081904 -5.207e-02 -2.309e-02  0.030729
beta[64]  -0.016649  -0.002446  4.915e-03  1.236e-02  0.026146
beta[65]  -0.627927  -0.242130 -8.721e-02  4.974e-02  0.337586
beta[66]  -0.055265  -0.036115 -2.647e-02 -1.683e-02  0.001892
beta[67]  -0.626884  -0.254483 -1.002e-01  4.397e-02  0.336025
beta[68]   0.106037   0.119494  1.267e-01  1.342e-01  0.148066
beta[69]   0.004146   0.119178  1.869e-01  2.635e-01  0.436215
beta[70]  -0.392773  -0.095418  4.680e-02  1.968e-01  0.554794
beta[71]  -0.866173  -0.336257 -1.563e-01 -5.746e-03  0.266603
beta[72]  -0.215210  -0.031382  6.333e-02  1.596e-01  0.378756
beta[73]   0.227346   0.308129  3.580e-01  4.144e-01  0.540522
beta[74]   0.039093   0.089888  1.188e-01  1.493e-01  0.206868
beta[75]   0.008776   0.016408  2.013e-02  2.402e-02  0.031236
beta[76]   0.189577   0.199207  2.045e-01  2.096e-01  0.219147
beta[77]  -0.200728  -0.096594 -4.746e-02  8.509e-04  0.093313
beta[78]  -0.193328  -0.096532 -4.633e-02  1.855e-03  0.093144
beta[79]   0.148877   0.159365  1.649e-01  1.706e-01  0.181136
beta[80]  -0.464251  -0.139227 -2.271e-04  1.401e-01  0.465108
beta[81]  -0.054630  -0.039936 -3.278e-02 -2.552e-02 -0.011789
beta[82]   0.084442   0.140423  1.708e-01  2.034e-01  0.266341
beta[83]  -0.053028   0.137956  2.625e-01  4.148e-01  0.847470
mu[1]      3.522734   3.571622  3.597e+00  3.624e+00  3.670472
mu[2]      2.934665   3.010136  3.047e+00  3.085e+00  3.152774
mu[3]     -0.697499  -0.289781 -1.004e-01  6.892e-02  0.362202
mu[4]     -3.111531  -2.188444 -1.784e+00 -1.433e+00 -0.837955
mu[5]      2.849737   2.922412  2.963e+00  3.002e+00  3.076407
mu[6]     -2.466439  -1.706076 -1.381e+00 -1.070e+00 -0.583645
mu[7]     -3.828128  -2.676097 -2.191e+00 -1.770e+00 -1.082587
mu[8]     -0.544970  -0.153763  2.121e-02  1.811e-01  0.450621
mu[9]     -5.233607  -3.420285 -2.761e+00 -2.216e+00 -1.421694
mu[10]     3.278419   3.345484  3.380e+00  3.414e+00  3.476815
mu[11]    -0.714762  -0.328312 -1.460e-01  2.463e-02  0.315043
mu[12]     3.411630   3.466355  3.494e+00  3.522e+00  3.574178
mu[13]     2.273891   2.381102  2.435e+00  2.490e+00  2.589476
mu[14]     2.023863   2.141754  2.200e+00  2.255e+00  2.359443
mu[15]     1.297227   1.460472  1.541e+00  1.621e+00  1.756937
mu[16]    -2.089790  -1.419189 -1.116e+00 -8.494e-01 -0.385990
mu[17]     1.407796   1.575322  1.661e+00  1.742e+00  1.886456
mu[18]   -48.522696 -34.330195 -2.370e+01 -1.614e+01 -5.255296
mu[19]     1.319087   1.485238  1.569e+00  1.648e+00  1.784907
mu[20]    -8.606864  -5.326423 -4.116e+00 -3.189e+00 -1.987699
mu[21]    -0.108506   0.194547  3.358e-01  4.740e-01  0.713125
mu[22]    -5.630916  -3.715756 -2.922e+00 -2.288e+00 -1.433865
mu[23]     1.978499   2.082398  2.137e+00  2.188e+00  2.286316
mu[24]    -5.955439  -3.812509 -3.020e+00 -2.398e+00 -1.501652
mu[25]     3.881000   3.923999  3.947e+00  3.969e+00  4.011018
mu[26]   -11.047846  -5.998027 -4.450e+00 -3.360e+00 -2.029135
mu[27]   -12.180395  -6.519503 -4.835e+00 -3.620e+00 -2.086769
mu[28]     2.804561   2.873732  2.911e+00  2.948e+00  3.017415
mu[29]     1.940585   2.063179  2.126e+00  2.187e+00  2.299606
mu[30]    -2.438771  -1.572133 -1.212e+00 -8.736e-01 -0.361764
mu[31]    -2.652182  -1.862803 -1.517e+00 -1.204e+00 -0.700185
mu[32]    -5.937672  -3.791823 -3.020e+00 -2.396e+00 -1.487683
mu[33]     3.720906   3.772908  3.800e+00  3.826e+00  3.876986
mu[34]     2.647471   2.736792  2.782e+00  2.826e+00  2.905221
mu[35]   -12.423926  -6.407810 -4.729e+00 -3.558e+00 -2.140114
mu[36]     2.308081   2.407905  2.463e+00  2.517e+00  2.617400
mu[37]    -9.183619  -5.453795 -4.137e+00 -3.211e+00 -1.949345
mu[38]     2.519286   2.601592  2.643e+00  2.684e+00  2.758615
mu[39]    -3.357395  -2.356619 -1.909e+00 -1.519e+00 -0.892862
mu[40]    -3.814727  -2.645934 -2.155e+00 -1.735e+00 -1.086912
mu[41]     2.541319   2.633491  2.681e+00  2.727e+00  2.813298
mu[42]    -3.682709  -2.597620 -2.130e+00 -1.716e+00 -1.057331
mu[43]    -3.077589  -2.169461 -1.774e+00 -1.417e+00 -0.866546
mu[44]   -29.313943 -17.663825 -1.188e+01 -7.525e+00 -3.137309
mu[45]   -82.501910 -39.497817 -2.691e+01 -1.648e+01 -5.444618
mu[46]     0.051158   0.352574  4.934e-01  6.304e-01  0.878105
mu[47]    -1.355548  -0.785159 -5.379e-01 -3.131e-01  0.073889
mu[48]    -1.823836  -1.238662 -9.811e-01 -7.459e-01 -0.329499
mu[49]     4.660445   4.691248  4.707e+00  4.724e+00  4.754929
mu[50]     1.719717   1.858438  1.928e+00  1.998e+00  2.121282
mu[51]    -1.376774  -0.842922 -6.082e-01 -3.826e-01  0.001217
mu[52]    -5.249190  -3.493082 -2.802e+00 -2.247e+00 -1.422414
mu[53]     2.227691   2.334012  2.387e+00  2.437e+00  2.529315
mu[54]     0.904842   1.111551  1.210e+00  1.303e+00  1.463085
mu[55]    -1.769835  -1.184510 -9.205e-01 -6.834e-01 -0.262009
mu[56]     1.611982   1.764700  1.840e+00  1.913e+00  2.040331
mu[57]    -1.349509  -0.871281 -6.470e-01 -4.469e-01 -0.081663
mu[58]     2.215132   2.322070  2.375e+00  2.430e+00  2.524632
mu[59]    -1.100501  -0.631050 -4.125e-01 -2.128e-01  0.154303
mu[60]     1.907885   2.027226  2.090e+00  2.151e+00  2.269000
mu[61]    -7.831460  -4.976211 -3.894e+00 -3.038e+00 -1.900003
mu[62]     3.110104   3.170348  3.201e+00  3.233e+00  3.291422
mu[63]    -0.612006  -0.256788 -9.081e-02  6.673e-02  0.353381
mu[64]     2.548931   2.625213  2.665e+00  2.706e+00  2.781621
mu[65]    -8.248273  -5.060436 -3.928e+00 -3.068e+00 -1.918927
mu[66]     1.962224   2.069748  2.123e+00  2.175e+00  2.271533
mu[67]    -8.122593  -5.044410 -3.964e+00 -3.118e+00 -1.903408
mu[68]     2.598501   2.685185  2.729e+00  2.772e+00  2.850097
mu[69]    -3.700733  -2.462015 -1.976e+00 -1.530e+00 -0.901825
mu[70]    -8.120406  -4.987800 -3.896e+00 -3.036e+00 -1.862502
mu[71]    -9.655365  -5.514783 -4.155e+00 -3.195e+00 -1.951355
mu[72]    -4.924968  -3.365619 -2.730e+00 -2.203e+00 -1.432825
mu[73]    -2.689221  -1.734784 -1.314e+00 -9.563e-01 -0.398159
mu[74]    -0.550139  -0.181997 -4.776e-03  1.551e-01  0.438031
mu[75]     3.926851   3.967171  3.988e+00  4.010e+00  4.048135
mu[76]     3.386406   3.450820  3.484e+00  3.517e+00  3.578676
mu[77]    -2.085966  -1.436318 -1.157e+00 -8.908e-01 -0.446804
mu[78]    -2.085994  -1.438868 -1.144e+00 -8.806e-01 -0.428121
mu[79]     3.219375   3.287702  3.322e+00  3.356e+00  3.418135
mu[80]    -7.681546  -4.905287 -3.819e+00 -3.017e+00 -1.822577
mu[81]     2.530423   2.606532  2.649e+00  2.691e+00  2.767835
mu[82]    -0.853052  -0.406468 -2.022e-01 -1.516e-02  0.310442
mu[83]    -8.051976  -4.601659 -3.517e+00 -2.686e+00 -1.621024</code></pre>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># par(mar = c(2, 2, 2, 2))  # smaller margins</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(samp)</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># # Density plots</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># densplot(samp, main = "Posterior Density for Parameters")</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co"># posterior_summary &lt;- summary(samp)</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># round(posterior_summary$statistics, 3)  # means, SDs</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co"># round(posterior_summary$quantiles, 3)   # 2.5%, 50%, 97.5%</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co"># beta_samples &lt;- as.matrix(samp)[, grep("beta", colnames(as.matrix(samp)))]</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co"># beta_means &lt;- apply(beta_samples, 2, mean)</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co"># beta_ci &lt;- apply(beta_samples, 2, quantile, probs = c(0.025, 0.975))</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co"># df &lt;- data.frame(</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   param = colnames(beta_samples),</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   mean = beta_means,</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   lower = beta_ci[1, ],</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   upper = beta_ci[2, ]</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(df, aes(x = param, y = mean)) +</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point() +</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_errorbar(aes(ymin = lower, ymax = upper), width = 0.2) +</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a><span class="co">#   coord_flip() +</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(title = "Posterior Estimates for Beta", y = "Effect Size", x = "") +</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a><span class="co"># # Heatmap</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a><span class="co"># # Your original year and serotype info</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a><span class="co"># year_seq &lt;- sort(unique(jdat$year_id))  # e.g., 2000:2006</span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a><span class="co"># sero_seq &lt;- 1:jdat$n_sero</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a><span class="co"># mean_year &lt;- (length(year_seq) + 1) / 2</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a><span class="co"># # Create a dataframe of all serotype-year combinations</span></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a><span class="co"># pred_grid &lt;- expand.grid(</span></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a><span class="co">#   sero = sero_seq,</span></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a><span class="co">#   year = year_seq</span></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a><span class="co"># # Predict expected log incidence</span></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a><span class="co"># pred_grid$log_lambda &lt;- mu_means[pred_grid$sero] +</span></span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a><span class="co">#   beta_means[pred_grid$sero] * (pred_grid$year - mean_year)</span></span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a><span class="co"># # Back-transform to incidence</span></span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a><span class="co"># pred_grid$lambda &lt;- exp(pred_grid$log_lambda)</span></span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(pred_grid, aes(x = year, y = factor(sero), fill = lambda)) +</span></span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_tile(color = "white") +</span></span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_viridis_c(name = "Expected\nCases", option = "C") +</span></span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(x = "Year", y = "Serotype", title = "Expected Cases by Year and Serotype") +</span></span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.y = element_text(size = 8))</span></span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(serotype_year_counts, aes(x = epiyr, y = SeroType, fill = cases)) +</span></span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_tile(color = "white") +</span></span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_viridis_c(option = "C", name = "Cases") +</span></span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(title = "IPD Cases by Serotype and Year",</span></span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a><span class="co">#        x = "Year",</span></span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a><span class="co">#        y = "Serotype") +</span></span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a><span class="co"># # Model version</span></span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a><span class="co"># mean_year &lt;- (max(serotype_year_counts$year_id) + 1) / 2</span></span>
<span id="cb25-65"><a href="#cb25-65" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb25-66"><a href="#cb25-66" aria-hidden="true" tabindex="-1"></a><span class="co"># # Create a data frame with expected log lambda for each serotype-year</span></span>
<span id="cb25-67"><a href="#cb25-67" aria-hidden="true" tabindex="-1"></a><span class="co"># serotype_year_counts$expected_log_lambda &lt;- mu_means[serotype_year_counts$sero_id] + </span></span>
<span id="cb25-68"><a href="#cb25-68" aria-hidden="true" tabindex="-1"></a><span class="co">#   beta_means[serotype_year_counts$sero_id] * (serotype_year_counts$year_id - mean_year)</span></span>
<span id="cb25-69"><a href="#cb25-69" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb25-70"><a href="#cb25-70" aria-hidden="true" tabindex="-1"></a><span class="co"># # Convert to expected cases (lambda)</span></span>
<span id="cb25-71"><a href="#cb25-71" aria-hidden="true" tabindex="-1"></a><span class="co"># serotype_year_counts$expected_cases &lt;- exp(serotype_year_counts$expected_log_lambda)</span></span>
<span id="cb25-72"><a href="#cb25-72" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb25-73"><a href="#cb25-73" aria-hidden="true" tabindex="-1"></a><span class="co"># # Plot</span></span>
<span id="cb25-74"><a href="#cb25-74" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(serotype_year_counts, aes(x = epiyr)) +</span></span>
<span id="cb25-75"><a href="#cb25-75" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(aes(y = cases), color = "blue", alpha = 0.5) +</span></span>
<span id="cb25-76"><a href="#cb25-76" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_line(aes(y = expected_cases, group = SeroType), color = "red") +</span></span>
<span id="cb25-77"><a href="#cb25-77" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_wrap(~ SeroType, scales = "free_y") +</span></span>
<span id="cb25-78"><a href="#cb25-78" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(y = "Cases", x = "Year", title = "Observed (points) vs Expected (lines) Cases by Serotype") +</span></span>
<span id="cb25-79"><a href="#cb25-79" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb25-80"><a href="#cb25-80" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>



</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-Spall2005" class="csl-entry" role="listitem">
<div class="csl-left-margin">1. </div><div class="csl-right-inline">Spall, J. C. <em>Introduction to Stochastic Search and Optimization : Estimation, Simulation, and Control</em>. 620 (Wiley, 2005).</div>
</div>
<div id="ref-Koller2009" class="csl-entry" role="listitem">
<div class="csl-left-margin">2. </div><div class="csl-right-inline">Koller, D. &amp; Friedman, N. <em>Structure Learning in Bayesian Networks</em>. <em>Probabilistic Graphical Models: Principles and Techniques</em> 783–848 (The MIT press, 2009).</div>
</div>
<div id="ref-Wasserman2004" class="csl-entry" role="listitem">
<div class="csl-left-margin">3. </div><div class="csl-right-inline">Wasserman, L. <em>All of Statistics</em>. (Springer New York, 2004). doi:<a href="https://doi.org/10.1007/978-0-387-21736-9">10.1007/978-0-387-21736-9</a>.</div>
</div>
<div id="ref-Lee2012" class="csl-entry" role="listitem">
<div class="csl-left-margin">4. </div><div class="csl-right-inline">Lee, S. &amp; Ni, J. <a href="https://doi.org/10.1155/2012/875641">Genetic algorithm for job scheduling with maintenance consideration in semiconductor manufacturing process</a>. <em>Mathematical Problems in Engineering</em> <strong>2012</strong>, 875641 (2012).</div>
</div>
<div id="ref-Bishop2006" class="csl-entry" role="listitem">
<div class="csl-left-margin">5. </div><div class="csl-right-inline">Bishop, C. M. <em><a href="https://link.springer.com/book/9780387310732">Pattern Recognition and Machine Learning | SpringerLink</a></em>. (Springer New York, NY, 2006).</div>
</div>
<div id="ref-Robert2004" class="csl-entry" role="listitem">
<div class="csl-left-margin">6. </div><div class="csl-right-inline">Robert, C. P. &amp; Casella, G. <em>Monte Carlo Statistical Methods</em>. (Springer New York, 2004). doi:<a href="https://doi.org/10.1007/978-1-4757-4145-2">10.1007/978-1-4757-4145-2</a>.</div>
</div>
<div id="ref-Geman1984" class="csl-entry" role="listitem">
<div class="csl-left-margin">7. </div><div class="csl-right-inline">Geman, S. &amp; Geman, D. Stochastic relaxation, gibbs distributions, and the bayesian restoration of images. <em>Institute of Electrical and Electronics Engineers (IEEE)</em> 721–741 (1984) doi:<a href="https://doi.org/10.1109/TPAMI.1984.4767596">10.1109/TPAMI.1984.4767596</a>.</div>
</div>
<div id="ref-gibbs_dist" class="csl-entry" role="listitem">
<div class="csl-left-margin">8. </div><div class="csl-right-inline">Wikipedia. <a href="https://en.wikipedia.org/wiki/Boltzmann_distribution">Boltzmann distribution</a>. <em>Wikipedia</em>.</div>
</div>
<div id="ref-josiah_gibbs" class="csl-entry" role="listitem">
<div class="csl-left-margin">9. </div><div class="csl-right-inline">Wikipedia. <a href="https://en.wikipedia.org/wiki/Josiah_Willard_Gibbs">Josiah willard gibbs</a>. <em>Wikipedia</em>.</div>
</div>
<div id="ref-Ellingson2023" class="csl-entry" role="listitem">
<div class="csl-left-margin">10. </div><div class="csl-right-inline">Ellingson, M. K., Weinberger, D. M., Linden, M. van der &amp; Perniciaro, S. <a href="https://doi.org/10.1093/INFDIS/JIAD538">Potential impact of higher-valency pneumococcal conjugate vaccines among adults in different localities in germany</a>. <em>The Journal of Infectious Diseases</em> <strong>229</strong>, 1669 (2023).</div>
</div>
<div id="ref-Perniciaro2022" class="csl-entry" role="listitem">
<div class="csl-left-margin">11. </div><div class="csl-right-inline">Perniciaro, S., Linden, M. V. D. &amp; Weinberger, D. M. <a href="https://doi.org/10.1093/CID/CIAC100">Reemergence of invasive pneumococcal disease in germany during the spring and summer of 2021</a>. <em>Clinical Infectious Diseases</em> <strong>75</strong>, 1149–1153 (2022).</div>
</div>
<div id="ref-mmwr_cdc" class="csl-entry" role="listitem">
<div class="csl-left-margin">12. </div><div class="csl-right-inline">Disease Control, C. for &amp; (CDC), P. MMWR weeks definition.</div>
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/ysph-dsde\.github\.io\/bdsy-phm\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>This site was built on a ysph-dsde.github.io page. <br> It was rendered using Quarto (v 1.6.3) and theme <a href="https://github.com/thomaspark/bootswatch">flatly</a>.</p>
</div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://canvas.yale.edu/login" target="_blank">
<p>Course Canvas</p>
</a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:BDSY2025PublicHealthModeling@yale.edu">
      <i class="bi bi-envelope" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://ysph.yale.edu/" target="_blank">
      <i class="bi bi-globe" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://ysph.yale.edu/public-health-research-and-practice/research-centers-and-initiatives/public-health-data-science-and-data-equity/" target="_blank">
      <i class="bi bi-people-fill" role="img">
</i> 
    </a>
  </li>  
</ul>
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/ysph-dsde/bdsy-phm/blob/main/Pages/Week3/Hierarchical Modeling.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/ysph-dsde/bdsy-phm/issues" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 Office Hours 12:30 PM - 1:30 PM 
<br>
60 College St., Room 206 or Zoom upon request
<br>
Walk-In: Tuesday or Wednesday
<br>
<a href="https://outlook.office.com/book/BigDataSummerImmersionatYaleBDSYOfficeHours@yale.edu/?ismsaljsauthenabled">Book Appointment</a>: Monday or Thursday
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>