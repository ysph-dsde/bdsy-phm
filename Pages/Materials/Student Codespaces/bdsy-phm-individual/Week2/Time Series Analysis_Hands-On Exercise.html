<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Daniel Weinberger, PhD">
<meta name="author" content="Stephanie Perniciaro, PhD, MPH">
<meta name="author" content="Shelby Golden, MS">
<meta name="dcterms.date" content="2025-06-24">

<title>Time Series Analysis – Public Health Modeling Group</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../../site_libs/quarto-nav/headroom.min.js"></script>
<link href="../../../../../Images/DSDE-Social-Media-Profile.png" rel="icon" type="image/png">
<script src="../../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../../site_libs/quarto-html/quarto-syntax-highlighting-05fe91a66cf75bbbb8c9664867fe5124.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../../site_libs/bootstrap/bootstrap-15b25b2f075b6074bc8cd4340dd52a59.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../../../index.html">
    <span class="navbar-title">Public Health Modeling Group</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../../Pages/Schedule.html"> 
<span class="menu-text">Assignments</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../../Pages/Materials/Materials.html"> 
<span class="menu-text">Project Materials</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-weekly-modules" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Weekly Modules</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-weekly-modules">    
        <li>
    <a class="dropdown-item" href="../../../../../Pages/Week2/Time Series Analysis_Hands-On Exercise.html">
 <span class="dropdown-text">Time Series</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../../Pages/Week3/Hierarchical Modeling.html">
 <span class="dropdown-text">Hierarchical Modeling</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://ysph.yale.edu/school-of-public-health/special-programs/big-data-summer-immersion-at-yale/" target="_blank"> 
<span class="menu-text">2025 BDSY</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#preamble" id="toc-preamble" class="nav-link" data-scroll-target="#preamble">Preamble</a></li>
  <li><a href="#set-up-the-environment" id="toc-set-up-the-environment" class="nav-link" data-scroll-target="#set-up-the-environment">Set Up the Environment</a>
  <ul class="collapse">
  <li><a href="#data-dictionary" id="toc-data-dictionary" class="nav-link" data-scroll-target="#data-dictionary">Data Dictionary</a></li>
  </ul></li>
  <li><a href="#initial-plot-of-the-time-series" id="toc-initial-plot-of-the-time-series" class="nav-link" data-scroll-target="#initial-plot-of-the-time-series">Initial Plot of the Time Series</a></li>
  <li><a href="#simple-linear-model" id="toc-simple-linear-model" class="nav-link" data-scroll-target="#simple-linear-model">Simple Linear Model</a></li>
  <li><a href="#building-the-multiple-linear-model" id="toc-building-the-multiple-linear-model" class="nav-link" data-scroll-target="#building-the-multiple-linear-model">Building the Multiple Linear Model</a>
  <ul class="collapse">
  <li><a href="#add-controls-for-seasonality" id="toc-add-controls-for-seasonality" class="nav-link" data-scroll-target="#add-controls-for-seasonality">Add Controls for Seasonality</a></li>
  <li><a href="#add-controls-for-baseline-shifts" id="toc-add-controls-for-baseline-shifts" class="nav-link" data-scroll-target="#add-controls-for-baseline-shifts">Add Controls for Baseline Shifts</a></li>
  </ul></li>
  <li><a href="#does-the-disease-trend-or-level-change" id="toc-does-the-disease-trend-or-level-change" class="nav-link" data-scroll-target="#does-the-disease-trend-or-level-change">Does the Disease Trend or Level Change?</a>
  <ul class="collapse">
  <li><a href="#method-1.-interrupted-time-series-with-disconnected-segments" id="toc-method-1.-interrupted-time-series-with-disconnected-segments" class="nav-link" data-scroll-target="#method-1.-interrupted-time-series-with-disconnected-segments">Method 1. Interrupted Time Series with Disconnected Segments</a></li>
  <li><a href="#method-2.-interrupted-time-series-with-connected-segments-spline-model" id="toc-method-2.-interrupted-time-series-with-connected-segments-spline-model" class="nav-link" data-scroll-target="#method-2.-interrupted-time-series-with-connected-segments-spline-model">Method 2. Interrupted Time Series with Connected Segments (Spline Model)</a></li>
  <li><a href="#method-3-extrapolation-based-on-the-pre-vaccine-period" id="toc-method-3-extrapolation-based-on-the-pre-vaccine-period" class="nav-link" data-scroll-target="#method-3-extrapolation-based-on-the-pre-vaccine-period">Method #3: Extrapolation Based on the Pre-Vaccine Period</a></li>
  <li><a href="#compare-the-methods" id="toc-compare-the-methods" class="nav-link" data-scroll-target="#compare-the-methods">Compare the Methods</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/ysph-dsde/bdsy-phm/blob/main/Pages/Materials/Student Codespaces/bdsy-phm-individual/Week2/Time Series Analysis_Hands-On Exercise.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/ysph-dsde/bdsy-phm/issues" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Time Series Analysis</h1>
<p class="subtitle lead"></p><div class="line-block">In Class Hands-On Exercise<br>
BDSY 2025 - Public Health Modeling Project</div><p></p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Daniel Weinberger, PhD </p>
             <p>Stephanie Perniciaro, PhD, MPH </p>
             <p>Shelby Golden, MS </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 24, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>This workshop was developed by <a href="https://ysph.yale.edu/profile/daniel-weinberger/">Dr.&nbsp;Dan Weinberger</a> from the Yale School of Public Health (YSPH) for the 12<span class="math inline">^{th}</span> International Symposium on Pneumococci and Pneumococcal Diseases (ISPPD-12) hosted in Toronto, Canada in June 2022. Here, we have adapted his workshop session #1, which compares different methods for fitting a time series dataset&nbsp;<span class="citation" data-cites="isppd_github"><sup><a href="#ref-isppd_github" role="doc-biblioref">1</a></sup></span>. Students are encouraged to explore the workshop content that Dr.&nbsp;Weinberger put together to learn more about the subject:</p>
<ul>
<li><strong>GitHub:</strong> Find the code, original data, and slides&nbsp;<span class="citation" data-cites="isppd_github"><sup><a href="#ref-isppd_github" role="doc-biblioref">1</a></sup></span>.</li>
<li><strong>Workshop Webpage:</strong> Find a longer description of the workshop in the format of a mini course with links to video presentations of select sections - <em>Workshop on the evaluation of vaccine impact</em>&nbsp;<span class="citation" data-cites="isppd_webpage"><sup><a href="#ref-isppd_webpage" role="doc-biblioref">2</a></sup></span>.</li>
</ul>
<p>The data used here is a subset of the complete set used in Oliveira, L. H. D. <em>et al.&nbsp;2020</em>&nbsp;<span class="citation" data-cites="DeOliveira2021"><sup><a href="#ref-DeOliveira2021" role="doc-biblioref">3</a></sup></span>. In their paper, national-level mortality data spanning from 2000 to 2016 for children under 5 years of age was compiled and standardized by national mortality registers in 10 Latin American and Caribbean countries. The primary cause of death was classified using the International Classification of Diseases, Tenth Revision (ICD-10) codes (<a href="https://www.icd10data.com/ICD10CM/Codes/J00-J99/J09-J18">Influenza and pneumonia J09-J18</a> or Oliveira, L. H. D. <em>et al.&nbsp;2020</em> Supplementary Table 2)&nbsp;<span class="citation" data-cites="DeOliveira2021_supplement icd10_codes"><sup><a href="#ref-DeOliveira2021_supplement" role="doc-biblioref">4</a>,<a href="#ref-icd10_codes" role="doc-biblioref">5</a></sup></span>. The goal of the paper was to evaluate the efficacy of pneumococcal conjugate vaccines (PCVs) in children who received any part of the standard-of-care vaccination series.</p>
<p>Today, we are going to examine the efficacy of pneumococcal conjugate vaccines (PCVs) in children aged 2 to 59 months in Ecuador. The standard-of-care vaccination series involves a primary series of either two doses (administered at 2 and 4 months of age) or three doses (administered at 2, 4, and 6 months of age), with the option of an additional booster dose (administered at 12-18 months of age). This dataset does not differentiate between patients who received varying levels of inoculation, and instead reports the data if any PCV was delivered.</p>
</section>
<section id="preamble" class="level2">
<h2 class="anchored" data-anchor-id="preamble">Preamble</h2>
<p>This section is drawn from Dr.&nbsp;Weinberger’s recorded presentation <em>What is ‘vaccine impact’?; and Administrative data: challenges and opportunities for evaluation studies</em>&nbsp;<span class="citation" data-cites="isppd_video1"><sup><a href="#ref-isppd_video1" role="doc-biblioref">6</a></sup></span>.</p>
<p>Statistical inference can be reduced to quantitatively answering three types of questions:</p>
<ol type="1">
<li><strong>Causation:</strong> Was there a change, and can we identify what caused the change?</li>
<li><strong>Prediction:</strong> What do we expect to see in the future?</li>
<li><strong>Certainty:</strong> How reliable are the answers to the first two questions?</li>
</ol>
<p>A biotechnologist developing a vaccine is primarily concerned with proving that there was a favorable change, such as mitigating the disease process in an individual. In contrast, a public health analyst aims to determine the overall impact of the vaccine on the population. For example, an effective vaccine not only protects an individual but also attenuates transmission within their immediate social circle.</p>
<p>This requires contextualizing the vaccine’s impact as a combination of direct and indirect effects. It is important to identify and control for unexplained linear and non-linear trends unrelated to the introduction of a vaccine to a population. For example, were there changes in overall population health at the same time or changes to diagnostic methods?</p>
<p>We can appreciate that this is a Sisyphean task, but one that can be addressed with time series analysis. Keep in mind that the methods discussed here are most applicable to endemic diseases that are consistently present in the population, existing at a relatively stable and predictable level. The core reason is that these methods require us to have an idea of what we would expect to have seen had the vaccine not been introduced, allowing us to posit a realistic counterfactual for model evaluation.</p>
<p>Our study is framed by PICO. In black text are the general definitions for the acronym and in red text is the application to our example:</p>
<ul>
<li><strong>Population:</strong> The target population where the impact of a vaccine is to measured. <span style="color: red;">Children 2-59 months old.</span></li>
<li><strong>Intervention:</strong> The date and timeframe for a vaccine intervention. <span style="color: red;">Introduction of PCV10 to the Brazilian national immunization program.</span></li>
<li><strong>Comparator:</strong> Diseases or groups of diseases to compare against the intervention, which are <em>not</em> expected to be impacted by the intervention itself. <span style="color: red;">Counterfactual to demonstrate what would have happened if the vaccine had not been introduced, compared to the factual scenario.</span></li>
<li><strong>Outcome:</strong> The condition representing our expected results from the intervention. <span style="color: red;">Deaths due to pneumonia.</span></li>
</ul>
</section>
<section id="set-up-the-environment" class="level2">
<h2 class="anchored" data-anchor-id="set-up-the-environment">Set Up the Environment</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">init</span>()      <span class="co"># Initialize the project     </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">restore</span>()   <span class="co"># Download packages and their version saved in the lockfile</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(<span class="st">"readr"</span>)      <span class="co"># For reading in the data</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(<span class="st">"tibble"</span>)     <span class="co"># For handling tidyverse tibble data classes</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(<span class="st">"tidyr"</span>)      <span class="co"># For tidying data </span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(<span class="st">"dplyr"</span>)      <span class="co"># For data manipulation </span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(<span class="st">"stringr"</span>)    <span class="co"># For string manipulation</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(<span class="st">"MASS"</span>)       <span class="co"># Functions/datasets for statistical analysis</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(<span class="st">"lubridate"</span>)  <span class="co"># For date manipulation</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(<span class="st">"ggplot2"</span>)    <span class="co"># For creating static visualizations</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(<span class="st">"scales"</span>)     <span class="co"># For formatting plots axis</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(<span class="st">"gridExtra"</span>)  <span class="co"># Creates multiple grid-based plots</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to select "Not In"</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="st">'%!in%'</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(x,y)<span class="sc">!</span>(<span class="st">'%in%'</span>(x,y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The data has been cleaned and standardized for use here, and is imported directly using the GitHub raw URL. You can explore the additional data cleaning steps applied to all of the data in the instructor’s GitHub repository: <a href="https://github.com/ysph-dsde/bdsy-phm">ysph-dsde/bdsy-phm</a>. The original dataset and prior data cleaning, validation, and standardization can be found in the paper’s GitHub repository and Dr.&nbsp;Weinberger’s workshop GitHub repository&nbsp;<span class="citation" data-cites="DeOliveira2021 isppd_github"><sup><a href="#ref-isppd_github" role="doc-biblioref">1</a>,<a href="#ref-DeOliveira2021" role="doc-biblioref">3</a></sup></span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in the cleaned data directly from the instructor's GitHub.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://raw.githubusercontent.com/ysph-dsde/bdsy-phm/refs/heads/main/Data/ec_2to59m.csv"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize aspects and dimentions of our dataset.</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 144
Columns: 6
$ date         &lt;date&gt; 2005-01-01, 2005-02-01, 2005-03-01, 2005-04-01, 2005-05-…
$ country      &lt;chr&gt; "Ecuador", "Ecuador", "Ecuador", "Ecuador", "Ecuador", "E…
$ age_group    &lt;chr&gt; "2-59m", "2-59m", "2-59m", "2-59m", "2-59m", "2-59m", "2-…
$ doses        &lt;chr&gt; "Any", "Any", "Any", "Any", "Any", "Any", "Any", "Any", "…
$ J12_J18_prim &lt;dbl&gt; 50, 51, 53, 46, 62, 34, 38, 38, 28, 26, 33, 31, 46, 53, 5…
$ acm_noj_prim &lt;dbl&gt; 204, 171, 166, 197, 212, 180, 158, 167, 144, 149, 153, 14…</code></pre>
</div>
</div>
<section id="data-dictionary" class="level3">
<h3 class="anchored" data-anchor-id="data-dictionary">Data Dictionary</h3>
<p>It is crucial that we understand the meaning of each variable in our dataset. Sometimes, there are surprising aspects embedded within the variables that are not immediately discernible from the table itself. Many sources provide a “Data Dictionary” for this purpose, but at times, you may need to interpret the variable meanings based on context and methods.</p>
<p>This paper did not explicitly describe each variable in a “Data Dictionary”; therefore, the following was assembled based on the context and methods provided in the paper and its supplementary materials&nbsp;<span class="citation" data-cites="DeOliveira2021 DeOliveira2021_supplement"><sup><a href="#ref-DeOliveira2021" role="doc-biblioref">3</a>,<a href="#ref-DeOliveira2021_supplement" role="doc-biblioref">4</a></sup></span>.</p>
<ul>
<li><p><strong>date:</strong> The month when the events were recorded. This spans from 2005-01-01 to 2016-12-01.</p></li>
<li><p><strong>country:</strong> Specifies the country where the events were observed. This dataset only represents events recorded in Ecuador.</p></li>
<li><p><strong>age_group:</strong> The age of the person who is represented in the counts. This dataset only represents infants aged 2 months to almost 5 years of age (59 months).</p></li>
<li><p><strong>doses:</strong> Specifies the doses of PCV received. As described earlier, all possible combinations of the standard-of-care vaccination series and booster are represented here.</p></li>
<li><p><strong>J12_J18_prim:</strong> Primary cause of death is assigned to the ICD-10 codes J12-J18. We encourage you to read more about what these <a href="https://www.icd10data.com/ICD10CM/Codes/J00-J99/J09-J18">ICD-10 codes</a> represent&nbsp;<span class="citation" data-cites="DeOliveira2021_supplement icd10_codes"><sup><a href="#ref-DeOliveira2021_supplement" role="doc-biblioref">4</a>,<a href="#ref-icd10_codes" role="doc-biblioref">5</a></sup></span>.</p></li>
<li><p><strong>acm_noj_prim:</strong> Primary cause of death was assigned any other ICD=10 code, excluding only the J chapter, diseases of the respiratory system.</p></li>
</ul>
</section>
</section>
<section id="initial-plot-of-the-time-series" class="level2">
<h2 class="anchored" data-anchor-id="initial-plot-of-the-time-series">Initial Plot of the Time Series</h2>
<p>We begin each time series analysis by examining the entire span of data, typically plotted as a line or scatter plot. All methods for modeling the vaccination introduction time series data require the dates when the vaccine was introduced, in this case the PCV10 vaccine.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimation when the vaccine was introduced in YYYY-MM-DD format.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>vax.intro.date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2010-08-01"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Date when vaccine efficacy evaluations started; at least 12 months</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># following administration.</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>vax.eval.date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2011-08-01"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We are not going to spend time explaining how to plot using the <code>tidyverse</code> package <code>ggplot2()</code> here. Later in the week you will receive a lecture covering this topic. In the meantime, you are welcome to explore the <code>ggplot2</code> package documentation or the Data Science and Data Equity (DSDE) group’s online <a href="https://ysph-dsde.github.io/Book-of-Workshops/Data-Visualization-with-ggplot2/">Book of Workshops</a>&nbsp;<span class="citation" data-cites="ggplot2_doc book_workshops"><sup><a href="#ref-ggplot2_doc" role="doc-biblioref">7</a>,<a href="#ref-book_workshops" role="doc-biblioref">8</a></sup></span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> J12_J18_prim)) <span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Deaths Categorized by</span><span class="sc">\n</span><span class="st">ICD-10 Codes J12-18"</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Date"</span>, <span class="at">y =</span> <span class="st">"Counts for &lt;5 yo"</span>) <span class="sc">+</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Have y-axis for the two plots be the same.</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">250</span>) <span class="sc">+</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Reference line.</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> vax.intro.date, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_linedraw</span>()</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> acm_noj_prim)) <span class="sc">+</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Deaths Categorized by</span><span class="sc">\n</span><span class="st">Non-J chapter ICD-10 Codes"</span>,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Date"</span>, <span class="at">y =</span> <span class="st">"Counts for &lt;5 yo"</span>) <span class="sc">+</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Have y-axis for the two plots be the same.</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">250</span>) <span class="sc">+</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Reference line.</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> vax.intro.date, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_linedraw</span>()</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the plots side-by-side.</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Time-Series-Analysis_Hands-On-Exercise_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="simple-linear-model" class="level2">
<h2 class="anchored" data-anchor-id="simple-linear-model">Simple Linear Model</h2>
<p>To correctly fit a simple linear model to the data, we need to apply a linearization that appropriately reflects its distribution. There are more analytical approaches to achieve this that will not be covered here. We start by visually examining the distribution with a scatter plot.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>It is helpful to consider the data generation method, which can provide insights into the likely distribution.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>p_base <span class="ot">&lt;-</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> J12_J18_prim)) <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Deaths Scatter Plot"</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Date"</span>, <span class="at">y =</span> <span class="st">"Counts for &lt;5 yo"</span>) <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Have y-axis for the two plots be the same.</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_linedraw</span>()</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>p_base</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Time-Series-Analysis_Hands-On-Exercise_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Variables that reflect counts (i.e., the number of deaths per month) can be distributed as either Poisson or negative binomial. Note that Poisson regression may artificially narrow confidence intervals when the data is overdispersed. To address this, you can use a negative binomial regression or a quasipoisson model, which accounts for the unexplained variation. In this context, we will apply a negative binomial regression.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For modeling, we need to use an ordered, discrete variable. Simply, we </span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># can use the rownames for this purpose.</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(df, <span class="at">var =</span> <span class="st">"index"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">index =</span> <span class="fu">as.numeric</span>(index))</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the negative binomial regression.</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(J12_J18_prim <span class="sc">~</span> index , <span class="at">data =</span> df)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine the fitting results.</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm.nb(formula = J12_J18_prim ~ index, data = df, init.theta = 38.18819754, 
    link = log)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  3.8223994  0.0389150   98.22   &lt;2e-16 ***
index       -0.0062897  0.0004981  -12.63   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for Negative Binomial(38.1882) family taken to be 1)

    Null deviance: 304.02  on 143  degrees of freedom
Residual deviance: 142.25  on 142  degrees of freedom
AIC: 976.12

Number of Fisher Scoring iterations: 1

              Theta:  38.2 
          Std. Err.:  10.2 

 2 x log-likelihood:  -970.12 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions with confidence intervals.</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod1, <span class="at">type =</span> <span class="st">"response"</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the model predictions and 95% COI to the dataframe.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>df.pred <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">se.fit =</span> pred<span class="sc">$</span>se.fit, <span class="at">pred =</span> pred<span class="sc">$</span>fit) <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">conf.low =</span> pred <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se.fit,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">conf.high =</span> pred <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se.fit</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the newly created model fitting.</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>p_sm <span class="ot">&lt;-</span> p_base <span class="sc">+</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add the fitting line.</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df.pred, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> pred),</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"#e41a1c"</span>) <span class="sc">+</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add the confidence interval.</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> df.pred, <span class="fu">aes</span>(<span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high), </span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Change the title name.</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Deaths with a Negative Binomial Fit"</span>)</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>p_sm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Time-Series-Analysis_Hands-On-Exercise_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>This is not a terrible predictor of our trend, but it overlooks many known sources of variance. For instance, we know that infections have seasonal trends, sometimes referred to by its technical term periodicity. Additionally, our baseline population may change from 2005 to 2016, which can consequently shift the overall disease trend in tandem with these baseline changes.</p>
</section>
<section id="building-the-multiple-linear-model" class="level2">
<h2 class="anchored" data-anchor-id="building-the-multiple-linear-model">Building the Multiple Linear Model</h2>
<div class="img-float">
<div class="quarto-figure quarto-figure-center" style="float: left; position: relative; top: 0px; padding-right: 30px; margin: auto auto auto auto;">
<figure class="figure">
<p><img src="Images/Principles of Seasonal Time Series.png" class="img-fluid figure-img" width="450"></p>
<figcaption>Principles of Seasonality - Generated with Yale’s AI Clarity</figcaption>
</figure>
</div>
</div>
<section id="add-controls-for-seasonality" class="level3">
<h3 class="anchored" data-anchor-id="add-controls-for-seasonality">Add Controls for Seasonality</h3>
<p>Seasonality often manifests as periodicity, where recurring patterns repeat at regular, fixed intervals of time. This differs from the related concept of cyclicity, which represents recurring patterns that do not occur at regular intervals or consistently appear in regular seasons&nbsp;<span class="citation" data-cites="periodicity"><sup><a href="#ref-periodicity" role="doc-biblioref">9</a></sup></span>.</p>
<p>Each seasonal pattern can be decomposed into three components that can either remain constant (stationary) or change over time (non-stationary): mean, variance, and covariance. The figure on the left illustrates the four possible seasonal trends separately. The top-left panel shows a recurring pattern with time-invariant, stationary parameters, while the other panels demonstrate the effects of non-stationary parameters.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Most time series data in the natural sciences exhibit seasonality, periodicity, or cyclicity, though these patterns may be difficult to detect when the data is noisy&nbsp;<span class="citation" data-cites="Ramanathan2020"><sup><a href="#ref-Ramanathan2020" role="doc-biblioref">10</a></sup></span>.</p>
</div>
</div>
<p>To control for temporal variations such as seasonality, we employ a simple form of dynamic linear regression (DLR). Essentially, we add variables to our simple linear regression model that represents different subsections of time as new regressors. Applying a DLR allows for changes in the mean value of the underlying regression relationship&nbsp;<span class="citation" data-cites="Young2011"><sup><a href="#ref-Young2011" role="doc-biblioref">11</a></sup></span>. For the regression function to recognize each date, we need to factorize the date variable to assign the month the observation occured.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>month <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">month</span>(df<span class="sc">$</span>date))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect the first 36 entries.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>month[<span class="dv">1</span><span class="sc">:</span><span class="dv">36</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1  2  3  4  5  6  7  8  9  10 11 12 1  2  3  4  5  6  7  8  9  10 11 12 1 
[26] 2  3  4  5  6  7  8  9  10 11 12
Levels: 1 2 3 4 5 6 7 8 9 10 11 12</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Update the model.</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(J12_J18_prim <span class="sc">~</span> date <span class="sc">+</span> month, <span class="at">data =</span> df)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm.nb(formula = J12_J18_prim ~ date + month, data = df, init.theta = 88.28907799, 
    link = log)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  6.496e+00  2.156e-01  30.132  &lt; 2e-16 ***
date        -1.988e-04  1.426e-05 -13.941  &lt; 2e-16 ***
month2      -2.717e-02  8.166e-02  -0.333 0.739391    
month3       3.446e-02  8.086e-02   0.426 0.669971    
month4      -1.892e-01  8.441e-02  -2.241 0.025011 *  
month5      -4.964e-02  8.228e-02  -0.603 0.546315    
month6      -1.571e-01  8.409e-02  -1.868 0.061714 .  
month7      -2.118e-01  8.513e-02  -2.488 0.012840 *  
month8      -2.076e-01  8.518e-02  -2.437 0.014804 *  
month9      -3.266e-01  8.749e-02  -3.733 0.000189 ***
month10     -2.253e-01  8.574e-02  -2.627 0.008603 ** 
month11     -2.467e-01  8.626e-02  -2.859 0.004243 ** 
month12     -3.386e-01  8.813e-02  -3.842 0.000122 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for Negative Binomial(88.2891) family taken to be 1)

    Null deviance: 404.40  on 143  degrees of freedom
Residual deviance: 143.84  on 131  degrees of freedom
AIC: 959.32

Number of Fisher Scoring iterations: 1

              Theta:  88.3 
          Std. Err.:  41.2 

 2 x log-likelihood:  -931.319 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions with confidence intervals.</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>pred2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod2, <span class="at">type =</span> <span class="st">"response"</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the model predictions and 95% COI to the dataframe.</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>df.pred2 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">se.fit =</span> pred2<span class="sc">$</span>se.fit, <span class="at">pred =</span> pred2<span class="sc">$</span>fit) <span class="sc">%&gt;%</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">conf.low =</span> pred <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se.fit,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">conf.high =</span> pred <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se.fit</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the newly created model fitting.</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>p_season <span class="ot">&lt;-</span> p_base <span class="sc">+</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add the fitting line.</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df.pred2, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> pred),</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"#e41a1c"</span>) <span class="sc">+</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add the confidence interval.</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> df.pred2, <span class="fu">aes</span>(<span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high), </span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Change the title name.</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Deaths with a Negative Binomial Fit</span><span class="sc">\n</span><span class="st">Seasonality Term Included"</span>)</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>p_season</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Time-Series-Analysis_Hands-On-Exercise_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="add-controls-for-baseline-shifts" class="level3">
<h3 class="anchored" data-anchor-id="add-controls-for-baseline-shifts">Add Controls for Baseline Shifts</h3>
<div class="img-float">
<div class="quarto-figure quarto-figure-center" style="float: right; position: relative; top: 0px; padding-left: 30px; margin: auto auto auto auto;">
<figure class="figure">
<p><img src="Images/Principles of Offsetting.png" class="img-fluid figure-img" width="450"></p>
<figcaption>Figure by Dr.&nbsp;Dan Weinberger - Generated with Yale’s AI Clarity &nbsp;<span class="citation" data-cites="isppd_video1"><sup><a href="#ref-isppd_video1" role="doc-biblioref">6</a></sup></span></figcaption>
</figure>
</div>
</div>
<p>We can expect that the baseline population changes over time, introducing unaccounted-for heterogeneous variance to our model. In epidemiology, it is standard to contextualize raw data by applying a denominator, or offset, that represents the population at risk of the disease.</p>
<p>The figure on the right illustrates how the baseline for the number of hospitalizations normalizes when we apply the population offset. Keep in mind that this ratio is often scaled to “per 100,000 persons.”&nbsp;<span class="citation" data-cites="isppd_video1"><sup><a href="#ref-isppd_video1" role="doc-biblioref">6</a></sup></span>.</p>
<p><span class="math display">
\frac{n_{cases}}{n_{population}} \times 100,000
</span></p>
<p>In real-world scenarios, the total base population is not always reported, or the coverage might be unreliable for the entire span of the time series. Alternatively, we can apply denominators such as the number of people using the healthcare system, the number of people hospitalized, and similar metrics&nbsp;<span class="citation" data-cites="isppd_video1"><sup><a href="#ref-isppd_video1" role="doc-biblioref">6</a></sup></span>. In this example, we could apply the total population size or all non-respiratory causes of mortality.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the offset using all deaths not coded as J. Transform the values</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># to log before use in the negative binomial fitting.</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>log.offset <span class="ot">&lt;-</span> <span class="fu">log</span>(df<span class="sc">$</span>acm_noj_prim)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Refit the model with an offset.</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>model3 <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(J12_J18_prim <span class="sc">~</span> index <span class="sc">+</span> month <span class="sc">+</span> <span class="fu">offset</span>(log.offset), <span class="at">data =</span> df)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm.nb(formula = J12_J18_prim ~ index + month + offset(log.offset), 
    data = df, init.theta = 59.08482937, link = log)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -1.3687586  0.0672076 -20.366  &lt; 2e-16 ***
index       -0.0034881  0.0004599  -7.584 3.36e-14 ***
month2       0.1651225  0.0873636   1.890   0.0587 .  
month3       0.1509818  0.0867654   1.740   0.0818 .  
month4      -0.0005318  0.0899497  -0.006   0.9953    
month5       0.0704091  0.0880910   0.799   0.4241    
month6       0.0227796  0.0896446   0.254   0.7994    
month7      -0.0122476  0.0906691  -0.135   0.8925    
month8       0.0077403  0.0907734   0.085   0.9320    
month9      -0.0526956  0.0929670  -0.567   0.5708    
month10     -0.0053806  0.0912550  -0.059   0.9530    
month11      0.0443924  0.0916610   0.484   0.6282    
month12     -0.0283404  0.0935272  -0.303   0.7619    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for Negative Binomial(59.0848) family taken to be 1)

    Null deviance: 219.59  on 143  degrees of freedom
Residual deviance: 145.49  on 131  degrees of freedom
AIC: 977.59

Number of Fisher Scoring iterations: 1

              Theta:  59.1 
          Std. Err.:  21.1 

 2 x log-likelihood:  -949.594 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions with confidence intervals.</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>pred3 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model3, <span class="at">type =</span> <span class="st">"response"</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the model predictions and 95% COI to the dataframe.</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>df.pred3 <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">se.fit =</span> pred3<span class="sc">$</span>se.fit, <span class="at">pred =</span> pred3<span class="sc">$</span>fit) <span class="sc">%&gt;%</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">conf.low =</span> pred <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se.fit,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">conf.high =</span> pred <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se.fit</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the newly created model fitting.</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>p_offset <span class="ot">&lt;-</span> p_base <span class="sc">+</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add the fitting line.</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df.pred3, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> pred),</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"#e41a1c"</span>) <span class="sc">+</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add the confidence interval.</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> df.pred3, <span class="fu">aes</span>(<span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high), </span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Change the title name.</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Deaths with a Negative Binomial Fit</span><span class="sc">\n</span><span class="st">Seasonality Term and Offset"</span>)</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>p_offset</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Time-Series-Analysis_Hands-On-Exercise_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Notice that the seasonality trend, which was clear in the previous plot, is disrupted when the population offset is applied. Now that we have our baseline model, we are ready to proceed with examining the effect of the intervention with PCV10 after its introduction on 2010-08-01.</p>
</section>
</section>
<section id="does-the-disease-trend-or-level-change" class="level2">
<h2 class="anchored" data-anchor-id="does-the-disease-trend-or-level-change">Does the Disease Trend or Level Change?</h2>
<p>In this section, we will test whether the trend or level of pneumonia deaths due to pneumococcal disease changes after the introduction of the PCV10 vaccine. To accomplish this, we will set up a counterfactual model to represent what our base model predicts the death counts would have been if the vaccine had not been introduced to the population. Similarly, a factual model will be applied to represent what actually happened with the vaccine rollout.</p>
<p>We will then compare the factual model against the counterfactual model to determine if a difference is identified in the period following vaccine introduction. This process is generally referred to as detecting vaccine effect or vaccine impact.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>You want to be careful when applying causal inference methods to model building, perturbation, or prediction questions. While our analysis uses a causal framework to detect the possible impact of the vaccine introduction, this does not permit us to make definitive claims of causation.</p>
<p>Additionally, it is important to remember that the model we have built may have other flaws influencing its sensitivity to the pre/post vaccination period. It is always best practice to test a model under different conditions and subject it to various tests to robustly justify its accuracy, precision, and generalizability.</p>
</div>
</div>
<p>The figure below illustrates the three phases of the vaccine rollout: pre-vaccination, post-vaccination, and a latency period between the start of vaccine distribution and efficacy evaluation. Recall that our base negative binomial model accounts for three effector variables: an ordered, discrete variable organizing the outcomes temporally without seasonality, the month to capture seasonal periodicity, and an offset to the baseline accounting for population changes. Our baseline model is expected to, and is therefore assumed to, detect the drop in average cases during the post-vaccination period.</p>
<div class="quarto-figure quarto-figure-center" style="float: none; display: block; margin-left: auto; margin-right: auto; width: 90%;">
<figure class="figure">
<p><img src="Images/Vaccine Effect with Counterfactual.png" class="img-fluid figure-img"></p>
<figcaption>Figure by Dr.&nbsp;Dan Weinberger - From his recorded lecture <em>Interrupted time series analysis</em>&nbsp;<span class="citation" data-cites="isppd_video2"><sup><a href="#ref-isppd_video2" role="doc-biblioref">12</a></sup></span>.</figcaption>
</figure>
</div>
<p>This model, however, does not explicitly assign outcomes to the three phases represented in the figure. Therefore, we need to set up variables that distinguish outcomes before and after the vaccine introduction, as well as before and after the entry to the vaccine evaluation phase, in order to convert the base model into our factual and counterfactual models.</p>
<p>We also need to regenerate the model to produce factually-based and counterfactually-based predictions for comparison. There are three modeling approaches we will evaluate here, each employing a different method to define the pre/post and latency vaccination periods. These differences will impact our inference about vaccine effectiveness.</p>
<ol type="1">
<li><p><strong>Interrupted Time Series with Disconnected Segments:</strong> This method fits different line segments through the data and tests whether the slope or level of the disease changes. It can sometimes result in abrupt jumps when fitting the model.</p></li>
<li><p><strong>Interrupted Time Series with Connected Segments (Spline Model):</strong> This method allows the slope to change in the post-vaccine period but ensures the change is smooth.</p></li>
<li><p><strong>Extrapolation Based on the Pre-Vaccine Period:</strong> This method fits the model to data from the pre-vaccine period only and extrapolates the trend to the post-vaccine period.</p></li>
</ol>
<section id="method-1.-interrupted-time-series-with-disconnected-segments" class="level3">
<h3 class="anchored" data-anchor-id="method-1.-interrupted-time-series-with-disconnected-segments">Method 1. Interrupted Time Series with Disconnected Segments</h3>
<p>We will add two new binary variables to our dataset: <code>vax_intro</code> and <code>vax_eval</code>. The <code>vax_intro</code> variable will be assigned a value of <code>0</code> before 2010-08-01 and <code>1</code> afterward; similarly, the <code>vax_eval</code> variable will be assigned a value of <code>0</code> before 2011-08-01 and <code>1</code> afterward.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign outcomes to the known vaccine phases.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">vax_intro =</span> <span class="fu">ifelse</span>(date <span class="sc">&gt;=</span> vax.intro.date, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">vax_eval =</span> <span class="fu">ifelse</span>(date <span class="sc">&gt;=</span> vax.eval.date, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co"># View the changes by randomly selecting dates.</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>df[<span class="fu">sort</span>(<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">144</span>, <span class="dv">10</span>)), <span class="fu">c</span>(<span class="st">"index"</span>, <span class="st">"date"</span>, <span class="st">"vax_intro"</span>, <span class="st">"vax_eval"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   index date       vax_intro vax_eval
   &lt;dbl&gt; &lt;date&gt;         &lt;dbl&gt;    &lt;dbl&gt;
 1    11 2005-11-01         0        0
 2    12 2005-12-01         0        0
 3    25 2007-01-01         0        0
 4    42 2008-06-01         0        0
 5    47 2008-11-01         0        0
 6    53 2009-05-01         0        0
 7    55 2009-07-01         0        0
 8    76 2011-04-01         1        0
 9    80 2011-08-01         1        1
10   119 2014-11-01         1        1</code></pre>
</div>
</div>
<p>In linear modeling, it is common to include interaction terms. These terms allow the model to capture interdependencies between variables, showing how the effect of one variable on the outcome changes depending on the level of another variable. Interaction terms also enable the identification of synergistic effects, where the combined effect of two variables is greater (or less) than the sum of their individual effects&nbsp;<span class="citation" data-cites="MontgomeryC2012"><sup><a href="#ref-MontgomeryC2012" role="doc-biblioref">13</a></sup></span>.</p>
<p>Equation 1 shows a multiple linear regression without an interaction term, and Equation 2 shows the inclusion of the interaction term. Notice that including the interaction term impacts the slope, making it dependent on the value of the other predictor. For example, the impact of <span class="math inline">X_1</span>, holding <span class="math inline">X_2</span> constant, on the slope of <span class="math inline">Y</span> is a function of <span class="math inline">(\beta_1 + \beta_3)\ X_2</span>&nbsp;<span class="citation" data-cites="MontgomeryC2012"><sup><a href="#ref-MontgomeryC2012" role="doc-biblioref">13</a></sup></span>.</p>
<p><span class="math display">\begin{align}
Y &amp;= \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \epsilon\\
Y &amp;= \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \beta_3 (X_1 \times X_2) + \epsilon
\end{align}</span></p>
<p>We will not spend more time discussing interaction terms but will briefly examine if they enhance the model’s predictive power. Note that while interaction terms can improve predictive accuracy, they also complicate the model and may result in a trade-off between predictive power and generalizability to other datasets.</p>
<p>First we will generate the two models, then we will evaluate their performance side-by-side.</p>
<section id="no-interaction-terms" class="level4">
<h4 class="anchored" data-anchor-id="no-interaction-terms">No Interaction Terms</h4>
<p>Create a simple step-change model without an interaction term involving the newly added variables, <code>vax_intro</code> and <code>vax_eval</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Additional seasonality controls covered in the collapsed box above.</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>mod_method1a <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(J12_J18_prim <span class="sc">~</span> index <span class="sc">+</span> month <span class="sc">+</span> <span class="fu">offset</span>(log.offset) <span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># Change in disease during administration and </span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># evaluation period.</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>                         vax_intro <span class="sc">+</span> vax_eval, <span class="at">data =</span> df)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_method1a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm.nb(formula = J12_J18_prim ~ index + month + offset(log.offset) + 
    vax_intro + vax_eval, data = df, init.theta = 64.37470892, 
    link = log)

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -1.382710   0.069290 -19.956   &lt;2e-16 ***
index       -0.002510   0.001014  -2.476   0.0133 *  
month2       0.163233   0.086008   1.898   0.0577 .  
month3       0.147780   0.085409   1.730   0.0836 .  
month4      -0.004393   0.088661  -0.050   0.9605    
month5       0.065323   0.086796   0.753   0.4517    
month6       0.017042   0.088446   0.193   0.8472    
month7      -0.018766   0.089510  -0.210   0.8339    
month8       0.006893   0.089471   0.077   0.9386    
month9      -0.054212   0.091693  -0.591   0.5544    
month10     -0.006595   0.089942  -0.073   0.9416    
month11      0.041625   0.090381   0.461   0.6451    
month12     -0.031725   0.092285  -0.344   0.7310    
vax_intro   -0.167101   0.083391  -2.004   0.0451 *  
vax_eval     0.076690   0.083253   0.921   0.3570    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for Negative Binomial(64.3747) family taken to be 1)

    Null deviance: 225.73  on 143  degrees of freedom
Residual deviance: 145.44  on 129  degrees of freedom
AIC: 977.59

Number of Fisher Scoring iterations: 1

              Theta:  64.4 
          Std. Err.:  24.3 

 2 x log-likelihood:  -945.595 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="do">## --------------------</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Generate the factual model</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions with confidence intervals.</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>pred4 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod_method1a, <span class="at">type =</span> <span class="st">"response"</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="do">## --------------------</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Prepare a plot to visualize the factual model predictions</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the model predictions and 95% COI to the dataframe.</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>df.pred.its <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">se.fit =</span> pred4<span class="sc">$</span>se.fit, <span class="at">pred =</span> pred4<span class="sc">$</span>fit) <span class="sc">%&gt;%</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">conf.low =</span> pred <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se.fit,</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">conf.high =</span> pred <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se.fit</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the newly created model fitting.</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>p_m1a <span class="ot">&lt;-</span> p_base <span class="sc">+</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add the fitting line.</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df.pred.its, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> pred),</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"#377eb8"</span>) <span class="sc">+</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add the confidence interval.</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> df.pred.its, <span class="fu">aes</span>(<span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high), </span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Change the title name.</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Deaths with a Negative Binomial Fit</span><span class="sc">\n</span><span class="st">Interupted Time Series - No Interaction Terms"</span>)</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a><span class="do">## --------------------</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a><span class="do">## Generate the counterfactual model</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the vacccine effect variables by setting them to 0.</span></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>df.counterfactual.a <span class="ot">&lt;-</span> df</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>df.counterfactual.a<span class="sc">$</span>vax_intro <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>df.counterfactual.a<span class="sc">$</span>vax_eval <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the fitted values using the counterfactual setup instead.</span></span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>df.pred.its<span class="sc">$</span>pred4.cf.a <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod_method1a, <span class="at">type =</span> <span class="st">"response"</span>, </span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">newdata =</span> df.counterfactual.a)</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a><span class="do">## --------------------</span></span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a><span class="do">## Rate ratio to evaluate performance</span></span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the rate ratio between the factual and counterfactual values.</span></span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>df.pred.its<span class="sc">$</span>rr.its.a <span class="ot">&lt;-</span> df.pred.its<span class="sc">$</span>pred<span class="sc">/</span>df.pred.its<span class="sc">$</span>pred4.cf.a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="with-interaction-terms" class="level4">
<h4 class="anchored" data-anchor-id="with-interaction-terms">With Interaction Terms</h4>
<p>Create the more complicated model option by adding an interaction term involving <code>vax_intro</code> and <code>vax_eval</code>, keeping both individually and including with an interaction with <code>index</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>mod_method1b <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(J12_J18_prim<span class="sc">~</span>index <span class="sc">+</span> month <span class="sc">+</span> <span class="fu">offset</span>(log.offset) <span class="sc">+</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># Add the counterfactuals with an interaction term.</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                         vax_intro <span class="sc">+</span> vax_intro<span class="sc">*</span>index <span class="sc">+</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>                         vax_eval <span class="sc">+</span> vax_eval<span class="sc">*</span>index, <span class="at">data =</span> df)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_method1b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm.nb(formula = J12_J18_prim ~ index + month + offset(log.offset) + 
    vax_intro + vax_intro * index + vax_eval + vax_eval * index, 
    data = df, init.theta = 65.62229438, link = log)

Coefficients:
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)     -1.410897   0.074005 -19.065   &lt;2e-16 ***
index           -0.001660   0.001288  -1.288   0.1976    
month2           0.163960   0.085713   1.913   0.0558 .  
month3           0.148234   0.085153   1.741   0.0817 .  
month4          -0.003138   0.088498  -0.035   0.9717    
month5           0.067516   0.086678   0.779   0.4360    
month6           0.019034   0.088478   0.215   0.8297    
month7          -0.016266   0.089654  -0.181   0.8560    
month8           0.003650   0.089526   0.041   0.9675    
month9          -0.055524   0.091668  -0.606   0.5447    
month10         -0.008492   0.089787  -0.095   0.9247    
month11          0.039981   0.090176   0.443   0.6575    
month12         -0.032091   0.092017  -0.349   0.7273    
vax_intro        0.267869   1.533398   0.175   0.8613    
vax_eval        -0.184445   1.541114  -0.120   0.9047    
index:vax_intro -0.006384   0.020854  -0.306   0.7595    
index:vax_eval   0.004214   0.020870   0.202   0.8400    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for Negative Binomial(65.6223) family taken to be 1)

    Null deviance: 227.08  on 143  degrees of freedom
Residual deviance: 145.13  on 127  degrees of freedom
AIC: 980.44

Number of Fisher Scoring iterations: 1

              Theta:  65.6 
          Std. Err.:  25.0 

 2 x log-likelihood:  -944.439 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="do">## --------------------</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Generate the factual model</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions with confidence intervals.</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>pred5 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod_method1b, <span class="at">type =</span> <span class="st">"response"</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="do">## --------------------</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Prepare a plot to visualize the factual model predictions</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the model predictions and 95% COI to the dataframe.</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>df.pred.its <span class="ot">&lt;-</span> df.pred.its <span class="sc">%&gt;%</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">se.fit =</span> pred5<span class="sc">$</span>se.fit, <span class="at">pred =</span> pred4<span class="sc">$</span>fit) <span class="sc">%&gt;%</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">conf.low =</span> pred <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se.fit,</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">conf.high =</span> pred <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se.fit</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the newly created model fitting.</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>p_m1b <span class="ot">&lt;-</span> p_base <span class="sc">+</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add the fitting line.</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df.pred.its, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> pred),</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"#377eb8"</span>) <span class="sc">+</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add the confidence interval.</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> df.pred.its, <span class="fu">aes</span>(<span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high), </span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Change the title name.</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Deaths with a Negative Binomial Fit</span><span class="sc">\n</span><span class="st">Interupted Time Series - With Interaction Terms"</span>)</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a><span class="do">## --------------------</span></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a><span class="do">## Generate the counterfactual model</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the vacccine effect variables by setting them to 0.</span></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>df.counterfactual.b <span class="ot">&lt;-</span> df</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>df.counterfactual.b<span class="sc">$</span>vax_intro <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>df.counterfactual.b<span class="sc">$</span>vax_eval <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the fitted values using the counterfactual setup instead.</span></span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>df.pred.its<span class="sc">$</span>pred4.cf.b <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod_method1b, <span class="at">type =</span> <span class="st">"response"</span>, </span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">newdata =</span> df.counterfactual.b)</span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a><span class="do">## --------------------</span></span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a><span class="do">## Rate ratio to evaluate performance</span></span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the rate ratio between the factual and counterfactual values.</span></span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a>df.pred.its<span class="sc">$</span>rr.its.b <span class="ot">&lt;-</span> df.pred.its<span class="sc">$</span>pred<span class="sc">/</span>df.pred.its<span class="sc">$</span>pred4.cf.b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="compare-model-complexity" class="level4">
<h4 class="anchored" data-anchor-id="compare-model-complexity">Compare Model Complexity</h4>
<p>Let’s start by comparing how the fit differs between the models.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Overlay onto plot.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>p_m1a_pred <span class="ot">&lt;-</span> p_m1a <span class="sc">+</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_line</span>(<span class="at">data =</span> df.pred.its, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> pred4.cf.a),</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">'#e41a1c'</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Overlay onto plot.</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>p_m1b_pred <span class="ot">&lt;-</span> p_m1b <span class="sc">+</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_line</span>(<span class="at">data =</span> df.pred.its, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> pred4.cf.b),</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">'#e41a1c'</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p_m1a_pred, p_m1b_pred, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Time-Series-Analysis_Hands-On-Exercise_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>We do see differences with the prediction adherance to the data we trained the model on. By qualitative examination, it appears the model with interaction terms diverge more in the post-vaccination period.</p>
<p>The Akaike Information Criterion (AIC) is a one measure used to compare the goodness of fit of different statistical models, while also accounting for model complexity. It helps in model selection by balancing model fit and complexity, otherwise called the bias/variance trade-off.</p>
<p>There are different variations of AIC, but the basic definition is</p>
<p><span class="math display">
\text{AIC} = 2k - 2\ln(\mathcal{L})
</span></p>
<p>where <span class="math inline">k</span> is the number of parameters in the model and <span class="math inline">\mathcal{L}</span> is the maximum likelihood of the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(mod_method1a, mod_method1b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             df      AIC
mod_method1a 16 977.5948
mod_method1b 18 980.4387</code></pre>
</div>
</div>
<p>The results indicate that the AIC score is worse (higher) when interaction terms are included. Since there is no significant gain in performance, we will prefer the simpler model for better generalizability.</p>
<p>Below, we also observe that the interaction terms create unexpected trends in the factual/counterfactual ratio. Notably, the ratio is not 1 (indicating that factual and counterfactual predictions are the same) in the pre-vaccination period, which is not ideal.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect methods sensitivity to vaccine impact.</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>p_ratio <span class="ot">&lt;-</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(df.pred.its, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> rr.its.a)) <span class="sc">+</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Rate Ratio of the ITS Model"</span>,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Date"</span>, <span class="at">y =</span> <span class="st">"Rate ratio"</span>) <span class="sc">+</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> vax.intro.date, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> vax.intro.date <span class="sc">+</span> <span class="dv">30</span>, <span class="at">y =</span> <span class="fl">00.1</span>, <span class="at">label =</span> <span class="st">"Vaccine Introduced"</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">hjust =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_linedraw</span>()</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>p_ratio <span class="sc">+</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df.pred.its, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> rr.its.b),</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"#4daf4a"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Time-Series-Analysis_Hands-On-Exercise_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Code Like a Pro
</div>
</div>
<div class="callout-body-container callout-body">
<p>We won’t try to estimate a confidence interval on the rate ratio here. Students are encouraged to checkout the the <code>InterventionEvaluatR</code> package, which will automatically calculate the confidence intervals for these ratios.</p>
</div>
</div>
</section>
</section>
<section id="method-2.-interrupted-time-series-with-connected-segments-spline-model" class="level3">
<h3 class="anchored" data-anchor-id="method-2.-interrupted-time-series-with-connected-segments-spline-model">Method 2. Interrupted Time Series with Connected Segments (Spline Model)</h3>
<p>In this case, we force the changes to be smooth so that we don’t get a drastic jump after vaccination introduction that prematurly shows impact during the expected latency period. Therefore, we will add two new variables to our dataset: <code>spl1</code> and <code>spl2</code>. The <code>spl1</code> variable will be assigned a value of <code>0</code> before 2010-08-01 and <code>index - intro.index + 1</code> afterward; similarly, the <code>spl2</code> variable will be assigned a value of <code>0</code> before 2011-08-01 and <code>index - eval.index + 1</code> afterward.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identifies the row index that represents when the vaccine was introduced</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># and when the evaluation period started.</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>intro.index <span class="ot">&lt;-</span> <span class="fu">which</span>(df<span class="sc">$</span>date <span class="sc">==</span> vax.intro.date)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>eval.index  <span class="ot">&lt;-</span> <span class="fu">which</span>(df<span class="sc">$</span>date <span class="sc">==</span> vax.eval.date)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign outcomes to the known vaccine phases.</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">spl1 =</span> <span class="fu">ifelse</span>(index <span class="sc">-</span> intro.index <span class="sc">+</span> <span class="dv">1</span> <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">0</span>, index <span class="sc">-</span> intro.index <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">spl2 =</span> <span class="fu">ifelse</span>(index <span class="sc">-</span> eval.index <span class="sc">+</span> <span class="dv">1</span> <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">0</span>, index <span class="sc">-</span> eval.index <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect the changes.</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>df[<span class="fu">sort</span>(<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">144</span>, <span class="dv">10</span>)), <span class="fu">c</span>(<span class="st">"date"</span>, <span class="st">"index"</span>, <span class="st">"spl1"</span>, <span class="st">"spl2"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   date       index  spl1  spl2
   &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 2005-05-01     5     0     0
 2 2006-01-01    13     0     0
 3 2006-05-01    17     0     0
 4 2007-04-01    28     0     0
 5 2010-11-01    71     4     0
 6 2011-01-01    73     6     0
 7 2011-12-01    84    17     5
 8 2013-07-01   103    36    24
 9 2015-05-01   125    58    46
10 2016-11-01   143    76    64</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>mod_method2 <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(J12_J18_prim <span class="sc">~</span> index <span class="sc">+</span> month <span class="sc">+</span> <span class="fu">offset</span>(log.offset) <span class="sc">+</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># Post-vaccine changes.</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>                        spl1 <span class="sc">+</span> spl2, <span class="at">data =</span> df)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_method2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm.nb(formula = J12_J18_prim ~ index + month + offset(log.offset) + 
    spl1 + spl2, data = df, init.theta = 61.04668124, link = log)

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -1.397121   0.074586 -18.732   &lt;2e-16 ***
index       -0.002349   0.001237  -1.899   0.0576 .  
month2       0.164546   0.086841   1.895   0.0581 .  
month3       0.151023   0.086225   1.752   0.0799 .  
month4      -0.001397   0.089442  -0.016   0.9875    
month5       0.069656   0.087565   0.795   0.4263    
month6       0.020998   0.089150   0.236   0.8138    
month7      -0.013534   0.090170  -0.150   0.8807    
month8       0.006429   0.090270   0.071   0.9432    
month9      -0.055311   0.092521  -0.598   0.5500    
month10     -0.008406   0.090793  -0.093   0.9262    
month11      0.040934   0.091221   0.449   0.6536    
month12     -0.032326   0.093106  -0.347   0.7284    
spl1        -0.007961   0.007038  -1.131   0.2580    
spl2         0.007591   0.007271   1.044   0.2965    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for Negative Binomial(61.0467) family taken to be 1)

    Null deviance: 221.95  on 143  degrees of freedom
Residual deviance: 145.72  on 129  degrees of freedom
AIC: 980.3

Number of Fisher Scoring iterations: 1

              Theta:  61.0 
          Std. Err.:  22.3 

 2 x log-likelihood:  -948.296 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="do">## --------------------</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Generate the factual model</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions with confidence intervals.</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>df.pred.spl <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pred.spl =</span> <span class="fu">predict</span>(mod_method2, <span class="at">type =</span> <span class="st">"response"</span>))</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="do">## --------------------</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Generate the counterfactual model</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the vacccine effect variables by setting them to 0.</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>df.counterfactual.spl <span class="ot">&lt;-</span> df</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>df.counterfactual.spl<span class="sc">$</span>spl1 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>df.counterfactual.spl<span class="sc">$</span>spl2 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the fitted values.</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>df.pred.spl<span class="sc">$</span>pred.spl.cf <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod_method2, <span class="at">type =</span> <span class="st">"response"</span>, </span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">newdata =</span> df.counterfactual.spl)</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a><span class="do">## --------------------</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a><span class="do">## Rate ratio to evaluate performance</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the rate ratio between the fitted and counterfactual values.</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>df.pred.spl<span class="sc">$</span>rr.spline <span class="ot">&lt;-</span> df.pred.spl<span class="sc">$</span>pred.spl<span class="sc">/</span>df.pred.spl<span class="sc">$</span>pred.spl.cf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="do">## --------------------</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Prepare a plot to visualize the factual model predictions</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions with confidence intervals.</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>pred6 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod_method2, <span class="at">type =</span> <span class="st">"response"</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the model predictions and 95% COI to the dataframe.</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>df.pred.spl <span class="ot">&lt;-</span> df.pred.spl <span class="sc">%&gt;%</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">se.fit =</span> pred6<span class="sc">$</span>se.fit, <span class="at">pred =</span> pred6<span class="sc">$</span>fit) <span class="sc">%&gt;%</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">conf.low =</span> pred <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se.fit,</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">conf.high =</span> pred <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se.fit</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>p_m2 <span class="ot">&lt;-</span> </span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(df.pred.spl, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> J12_J18_prim)) <span class="sc">+</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Add the fitted line.</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="at">data =</span> df.pred.spl, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> pred.spl),</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">"#377eb8"</span>) <span class="sc">+</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Add the confidence interval.</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_ribbon</span>(<span class="at">data =</span> df.pred.spl, <span class="fu">aes</span>(<span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high),</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>                  <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Add the counterfactual line.</span></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="at">data =</span> df.pred.spl, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> pred.spl.cf),</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">"#e41a1c"</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Deaths with a Negative Binomial Fit</span><span class="sc">\n</span><span class="st">ITS with Spline Smoothing"</span>,</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Date"</span>, <span class="at">y =</span> <span class="st">"Counts for &lt;5 yo"</span>) <span class="sc">+</span></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_linedraw</span>()</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>p_m2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Time-Series-Analysis_Hands-On-Exercise_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>We can see here that the decline follows a smoother trajectory, by design. We can check the counterfactual performace by examining the ratio again.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect methods sensitivity to vaccine impact.</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>p_ratio <span class="ot">&lt;-</span> p_ratio <span class="sc">+</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_line</span>(<span class="at">data =</span> df.pred.spl, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> rr.spline),</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"#4daf4a"</span>) <span class="sc">+</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Update the title.</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Rate Ratio with the Spline Model"</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>p_ratio</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Time-Series-Analysis_Hands-On-Exercise_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="method-3-extrapolation-based-on-the-pre-vaccine-period" class="level3">
<h3 class="anchored" data-anchor-id="method-3-extrapolation-based-on-the-pre-vaccine-period">Method #3: Extrapolation Based on the Pre-Vaccine Period</h3>
<p>Now we are going to model only the pre-vaccination period and forecast outcomes based on the restricted fitting into the post-vaccination period. We will create a new variable that excludes any records following 2010-08-01, <code>J12_J18_prim</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new variable where it is J12_J18_prim until the vaccine is introduced,</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># then it is NA afterwards.</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>J12_J18_prim_pre <span class="ot">&lt;-</span> df<span class="sc">$</span>J12_J18_prim</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>J12_J18_prim_pre[<span class="fu">which</span>(df<span class="sc">$</span>date <span class="sc">&gt;=</span> vax.intro.date)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect the changes.</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>df[<span class="fu">sort</span>(<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">144</span>, <span class="dv">10</span>)), <span class="fu">c</span>(<span class="st">"date"</span>, <span class="st">"J12_J18_prim_pre"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
   date       J12_J18_prim_pre
   &lt;date&gt;                &lt;dbl&gt;
 1 2005-05-01               62
 2 2006-11-01               26
 3 2007-08-01               28
 4 2007-11-01               28
 5 2008-06-01               45
 6 2008-07-01               29
 7 2009-07-01               20
 8 2010-06-01               26
 9 2013-02-01               NA
10 2014-10-01               NA</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>mod_method3 <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(J12_J18_prim_pre <span class="sc">~</span> index <span class="sc">+</span> month <span class="sc">+</span> <span class="fu">offset</span>(log.offset), <span class="at">data =</span> df)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the prediction using the smoothed model.</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>df.pred.pre <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pred.pre =</span> <span class="fu">predict</span>(mod_method3, <span class="at">type =</span> <span class="st">"response"</span>, <span class="at">newdata =</span> df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Unlike before, the original observed variable <code>J12_J18_prim</code> now represents the factual model, as we regressed on a subset of data assuming nothing was known following the vaccine introduction. The prediction results using the restricted regressand represents the counterfactual model, since it extrapolates data points missing from the model fitting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="do">## --------------------</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Rate ratio to evaluate performance</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the rate ratio between the factual and counterfactual values.</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>df.pred.pre<span class="sc">$</span>rr.trend <span class="ot">&lt;-</span> df<span class="sc">$</span>J12_J18_prim<span class="sc">/</span>df.pred.pre<span class="sc">$</span>pred.pre</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="do">## --------------------</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Prepare a plot to visualize the factual model predictions</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions with confidence intervals.</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>pred7 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod_method3, <span class="at">type =</span> <span class="st">"response"</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>, <span class="at">newdata =</span> df)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the model predictions and 95% COI to the dataframe.</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>df.pred.pre <span class="ot">&lt;-</span> df.pred.pre <span class="sc">%&gt;%</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">se.fit =</span> pred7<span class="sc">$</span>se.fit, <span class="at">pred =</span> pred7<span class="sc">$</span>fit) <span class="sc">%&gt;%</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">conf.low =</span> pred <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se.fit,</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">conf.high =</span> pred <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se.fit</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>p_m3 <span class="ot">&lt;-</span> </span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(df.pred.pre, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> J12_J18_prim)) <span class="sc">+</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Add the fitted line.</span></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="at">data =</span> df.pred.pre, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> pred.pre),</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">"#377eb8"</span>) <span class="sc">+</span></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Add the confidence interval.</span></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_ribbon</span>(<span class="at">data =</span> df.pred.pre, <span class="fu">aes</span>(<span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high),</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>                  <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Deaths with a Negative Binomial Fit</span><span class="sc">\n</span><span class="st">Extrapolating Based on the Pre-Vaccine Period"</span>,</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Date"</span>, <span class="at">y =</span> <span class="st">"Counts for &lt;5 yo"</span>) <span class="sc">+</span></span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_linedraw</span>()</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>p_m3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Time-Series-Analysis_Hands-On-Exercise_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect methods sensitivity to vaccine impact.</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>p_ratio <span class="ot">&lt;-</span> p_ratio <span class="sc">+</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> df.pred.pre, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> rr.trend),</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">'#377eb8'</span>) <span class="sc">+</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Update the title.</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Rate Ratio with the Extrapolation Model"</span>)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>p_ratio</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Time-Series-Analysis_Hands-On-Exercise_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="compare-the-methods" class="level3">
<h3 class="anchored" data-anchor-id="compare-the-methods">Compare the Methods</h3>
<p>Let’s compare the rate ratio estimates from the three models. As a rough estimate, we will average the point-by-point estimates of the rate ratio during the evaluation period.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a Boolean variable that defines the vaccine evaluation period.</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>eval.period <span class="ot">&lt;-</span> df<span class="sc">$</span>date <span class="sc">&gt;</span> vax.eval.date</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the average outcome during the vaccine evaluation period.</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>rr.its.eval    <span class="ot">&lt;-</span> <span class="fu">mean</span>(df.pred.its<span class="sc">$</span>rr.its.a[eval.period])</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>rr.spline.eval <span class="ot">&lt;-</span> <span class="fu">mean</span>(df.pred.spl<span class="sc">$</span>rr.spline[eval.period])</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>rr.trend.eval  <span class="ot">&lt;-</span> <span class="fu">sum</span>(df.pred.pre<span class="sc">$</span>J12_J18_prim[eval.period])<span class="sc">/</span><span class="fu">sum</span>(df.pred.pre<span class="sc">$</span>pred.pre[eval.period])</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Average decline detected from 1.</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">c</span>(<span class="st">"ITS - Disconnected"</span> <span class="ot">=</span> rr.its.eval, <span class="st">"ITS - Spline"</span> <span class="ot">=</span> rr.spline.eval,</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Extrapolation"</span> <span class="ot">=</span> rr.trend.eval), <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ITS - Disconnected       ITS - Spline      Extrapolation 
              0.91               0.90               0.86 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Percent decline detected.</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="dv">100</span><span class="sc">*</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fu">round</span>(<span class="fu">c</span>(<span class="st">"ITS - Disconnected"</span> <span class="ot">=</span> rr.its.eval, <span class="st">"ITS - Spline"</span> <span class="ot">=</span> rr.spline.eval, </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Extrapolation"</span> <span class="ot">=</span> rr.trend.eval), <span class="at">digits =</span> <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ITS - Disconnected       ITS - Spline      Extrapolation 
                 9                 10                 14 </code></pre>
</div>
</div>
<p>Two of the modeling methods identified a decrease of approximately 10% in pneumonia deaths due to pneumococcal disease after the release of the PCV10 vaccine. The extrapolation method indicates a stronger vaccine effect; however, we expect some of this result to be spurious due to the level of random noise introduced by applying the observed values in the counterfactual ratio calculation.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>Depending on the dataset, these three methods may or may not agree to a greater extent.</p>
</div>
</div>
</section>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<div id="refs" class="references csl-bib-body" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-isppd_github" class="csl-entry" role="listitem">
<div class="csl-left-margin">1. </div><div class="csl-right-inline"><a href="https://github.com/DanWeinberger/isppd_workshop2022#">Weinberger, D. M. (2022)</a>.</div>
</div>
<div id="ref-isppd_webpage" class="csl-entry" role="listitem">
<div class="csl-left-margin">2. </div><div class="csl-right-inline">Weinberger, D. M. <em>et al.</em> <a href="https://vaccineevaluationworkshop.github.io/#content">Data analysis workshop at ISPPD | workshop on the evaluation of vaccine impact webpage</a>. (2022).</div>
</div>
<div id="ref-DeOliveira2021" class="csl-entry" role="listitem">
<div class="csl-left-margin">3. </div><div class="csl-right-inline">Oliveira, L. H. D. <em>et al.</em> <a href="https://doi.org/10.1093/CID/CIAA614,">Declines in pneumonia mortality following the introduction of pneumococcal conjugate vaccines in latin american and caribbean countries</a>. <em>Clinical Infectious Diseases</em> <strong>73</strong>, 306–313 (2021).</div>
</div>
<div id="ref-DeOliveira2021_supplement" class="csl-entry" role="listitem">
<div class="csl-left-margin">4. </div><div class="csl-right-inline">Oliveira, L. H. D. <em>et al.</em> <a href="http://hdr.undp.org/en/content/population-aged-under-5-millions">Declines in pneumonia mortality following the introduction of pneumococcal conjugate vaccines in latin american and caribbean countries - supplementary table 2</a>. <em>Clinical Infectious Diseases</em> <strong>73</strong>, 306–313 (2021).</div>
</div>
<div id="ref-icd10_codes" class="csl-entry" role="listitem">
<div class="csl-left-margin">5. </div><div class="csl-right-inline">icd10data.com. <a href="https://www.icd10data.com/ICD10CM/Codes/J00-J99/J09-J18">2025 ICD-10-CM codes J09-J18: Influenza and pneumonia</a>.</div>
</div>
<div id="ref-isppd_video1" class="csl-entry" role="listitem">
<div class="csl-left-margin">6. </div><div class="csl-right-inline">Weinberger, D. M. <em>et al.</em> <a href="https://www.youtube.com/watch?v=JnI9Hh8BWmk">1. Vaccine impact; administrative data sources and their pitfalls - YouTube</a>. <em>YouTube</em> (2021).</div>
</div>
<div id="ref-ggplot2_doc" class="csl-entry" role="listitem">
<div class="csl-left-margin">7. </div><div class="csl-right-inline">Wickham, H. <em>et al.</em> <em><a href="https://ggplot2.tidyverse.org/">Create Elegant Data Visualisations Using the Grammar of Graphics • Ggplot2</a></em>. (Springer-Verlag, 2016).</div>
</div>
<div id="ref-book_workshops" class="csl-entry" role="listitem">
<div class="csl-left-margin">8. </div><div class="csl-right-inline">Golden, S. <em><a href="https://ysph-dsde.github.io/Book-of-Workshops/Data-Visualization-with-ggplot2/">Data Visualization with Ggplot2 – Book of Workshops</a></em>. (2025).</div>
</div>
<div id="ref-periodicity" class="csl-entry" role="listitem">
<div class="csl-left-margin">9. </div><div class="csl-right-inline">Ninja, N. N. <a href="https://letsdatascience.com/periodicity-detecting-rhythms-in-data/">Periodicity: Detecting rhythms in data - let’s data science</a>. (2023).</div>
</div>
<div id="ref-Ramanathan2020" class="csl-entry" role="listitem">
<div class="csl-left-margin">10. </div><div class="csl-right-inline">Ramanathan, K. <em>et al.</em> <a href="https://doi.org/10.3390/IJERPH17041318,">Assessing seasonality variation with harmonic regression: Accommodations for sharp peaks</a>. <em>International Journal of Environmental Research and Public Health</em> <strong>17</strong>, (2020).</div>
</div>
<div id="ref-Young2011" class="csl-entry" role="listitem">
<div class="csl-left-margin">11. </div><div class="csl-right-inline">Young, P. C. <em>Recursive Estimation and Time-Series Analysis</em>. <em>Recursive Estimation and Time-Series Analysis</em> (Springer Berlin Heidelberg, 2011). doi:<a href="https://doi.org/10.1007/978-3-642-21981-8">10.1007/978-3-642-21981-8</a>.</div>
</div>
<div id="ref-isppd_video2" class="csl-entry" role="listitem">
<div class="csl-left-margin">12. </div><div class="csl-right-inline">Weinberger, D. M. <em>et al.</em> <a href="https://www.youtube.com/watch?v=rD_pTH3Lwk0">2. Interrupted time series analysis</a>. <em>YouTube</em> (2021).</div>
</div>
<div id="ref-MontgomeryC2012" class="csl-entry" role="listitem">
<div class="csl-left-margin">13. </div><div class="csl-right-inline">C, D. M., A, E. P. &amp; Vining, G. G. <em><a href="https://www.wiley.com/en-us/Introduction+to+Linear+Regression+Analysis%2C+6th+Edition-p-9781119578727">Introducing to Linear Regression Analysis (6th Ed.)</a></em>. <em>John Wiley and Sons</em> 642 (Wiley Series, 2012).</div>
</div>
</div>


</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/ysph-dsde\.github\.io\/bdsy-phm\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>This site was built on a ysph-dsde.github.io page. <br> It was rendered using Quarto (v 1.6.3) and theme <a href="https://github.com/thomaspark/bootswatch">flatly</a>.</p>
</div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://canvas.yale.edu/login" target="_blank">
<p>Course Canvas</p>
</a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:BDSY2025PublicHealthModeling@yale.edu">
      <i class="bi bi-envelope" role="img">
</i> 
    </a>
  </li>  
</ul>
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/ysph-dsde/bdsy-phm/blob/main/Pages/Materials/Student Codespaces/bdsy-phm-individual/Week2/Time Series Analysis_Hands-On Exercise.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/ysph-dsde/bdsy-phm/issues" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 Office Hours 12:30 PM - 1:30 PM 
<br>
60 College St., Room 206 or Zoom upon request
<br>
Walk-In: Tuesday or Wednesday
<br>
<a href="https://outlook.office.com/book/BigDataSummerImmersionatYaleBDSYOfficeHours@yale.edu/?ismsaljsauthenabled">Book Appointment</a>: Monday or Thursday
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>